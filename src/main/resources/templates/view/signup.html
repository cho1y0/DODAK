<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>회원가입 - DODAK</title>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
    
</script>
<link
	href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link rel="stylesheet" href="/css/style.css">
</head>
<body style="padding-top: 0;">

	<div class="signup-wrapper">
		<div class="signup-card">
			<h2>DODAK 회원가입</h2>

			<img src="/img/dodak.png" alt="도닥이 마스코트"
				style="width: 80px; margin-bottom: 20px;">

			<form action="/member/regist.do" method="post" id="registerForm">			
				<input type="hidden" id="agreements" name="agreements" value="0">
				<div class="form-group-section">
					<h5>
						<i class="bi bi-person-badge me-2"></i> 기본 정보
					</h5>

					<div class="mb-3">
						<label for="inputId" class="form-label-custom">아이디 <span
							class="required-star">*</span></label>
						<div class="input-group">
							<input type="text" class="form-control" id="inputId" name="userId"
								placeholder="ID 입력" maxlength="20" required="required">
							<button class="btn btn-outline-secondary" type="button"
								id="buttonIDCheck" onclick="checkId()">중복체크</button>
						</div>
						<span class="validation-info">5~20자, 영문+숫자 조합만 허용. (중복 불가)</span>
						<small id="idMessage" class="form-text text-muted"></small>
					</div>

					<div class="mb-3">
						<label for="inputPassword" class="form-label-custom">비밀번호
							<span class="required-star">*</span>
						</label> <input type="password" class="form-control" maxlength="20" id="inputPassword" name="password"
							placeholder="비밀번호 입력" required> <span
							class="validation-info">8~20자, 영문+숫자+특수문자 조합을 사용하세요.</span>
					</div>

					<div class="mb-4">
						<label for="inputPasswordConfirm" class="form-label-custom">비밀번호
							확인 <span class="required-star">*</span>
						</label> <input type="password" class="form-control"
							id="inputPasswordConfirm" placeholder="비밀번호 재입력" maxlength="20" required="required">
						<span class="validation-info">위의 비밀번호와 동일하게 입력해주세요.</span>
						<small id="pwMessage" ></small>
					</div>

					<div class="mb-3">
						<label for="inputName" class="form-label-custom">이름(한글) <span
							class="required-star">*</span></label> <input type="text"
							class="form-control" id="inputName" placeholder="실명 입력 (한글)" name = "name" maxlength="10"
							required="required"> <span class="validation-info">한글만 허용
							(2~10자).</span>
					</div>
				</div>

				<div class="form-group-section">
					<h5>
						<i class="bi bi-phone me-2"></i> 연락 정보
					</h5>

					<div class="mb-3">
						<label for="inputPhone" class="form-label-custom">휴대전화 <span
							class="required-star">*</span></label> <input type="tel"
							class="form-control" id="inputPhone" name="cellphone" placeholder="010-XXXX-XXXX"
							required="required"> <span class="validation-info">하이픈(-)을
							포함하여 010-XXXX-XXXX 형식으로 입력하세요.</span>
					</div>

					<div class="mb-3">
						<label for="inputEmail" class="form-label-custom">이메일 <span
							class="required-star">*</span></label>
						<div class="input-group">
							
							<input type="email"
							class="form-control" id="inputEmail" name="email"
							placeholder="example@dodak.com" required="required"> 
							<button class="btn btn-outline-secondary" type="button"
								id="buttonEmailCheck" onclick="validateEmail()">중복체크</button>
						</div>
						<span class="validation-info">이메일 형식 검증 및 중복 불가.</span>
						<small id="emailMessage" class="form-text text-muted"></small>						 
					</div>
					<small id="emailMessage" class="form-text text-muted"></small>
				</div>

				<div class="form-group-section">
					<h5>
						<i class="bi bi-house-door-fill me-2"></i> 주소 정보 <span
							class="required-star">*</span>
					</h5>

					<div class="mb-3">
						<div class="input-group">
							<input type="text" class="form-control" id="zipCode"
								placeholder="우편번호" name="zipCode" readonly required>
							<button class="btn btn-outline-secondary" type="button"
								id="buttonPostcodeSearch">우편번호 검색</button>
						</div>
					</div>

					<div class="mb-3">
						<input type="text" class="form-control" id="streetAdr" name="roadAddr"
							placeholder="도로명 주소" readonly required>
					</div>
					<div class="mb-4">
						<input type="text" class="form-control" id="inputAddressDetail" name="detailAddr"
							placeholder="상세 주소 (선택 입력)">
					</div>
				</div>

				<div class="form-group-section">
					<h5>
						<i class="bi bi-file-earmark-text me-2"></i> 약관 동의
					</h5>

					<div class="form-check mb-3">
						<input class="form-check-input" type="checkbox" id="checkAllTerms">
						<label class="form-check-label fw-bold" for="checkAllTerms">
							<i class="bi bi-check-circle-fill me-1" style="color: #a5d6a7;"></i>
							모든 약관 동의 (선택 포함)
						</label>
					</div>

					<hr style="border-style: dashed; margin: 15px 0;">

					<div class="mb-3 text-start">
						<div class="terms-scroll-area">
							[이용약관] 본 서비스는 사용자님의 마음을 도닥여주기 위한 목적으로... (약관 내용 스크롤) <br>
							<br> 제1조 (목적) 이 약관은 DODAK 서비스 이용 조건 및 절차에 관한 사항을 규정함을 목적으로
							한다. <br>
							<br> 제2조 (회원가입) ... (이하 생략) <br>
							<br> ... (스크롤 후 체크 가능 로직 필요)
						</div>
						<div class="form-check">
							<input class="form-check-input" type="checkbox" id="checkTerms1"
								required> <label class="form-check-label"
								for="checkTerms1"> 이용약관 동의 <span class="required-star">(필수)</span>
							</label>
						</div>
					</div>

					<div class="mb-3 text-start">
						<div class="form-check">
							<input class="form-check-input" type="checkbox" id="checkTerms2"
								required> <label class="form-check-label"
								for="checkTerms2"> 개인정보 처리방침 동의 <span
								class="required-star">(필수)</span>
							</label>
						</div>
					</div>

					<div class="mb-4 text-start">
						<div class="form-check">
							<input class="form-check-input" type="checkbox" id="checkTerms3">
							<label class="form-check-label" for="checkTerms3"> 마케팅 정보
								수신 동의 (이메일/SMS) (선택) </label>
						</div>
					</div>
				</div>

				<button type="submit" class="btn btn-success w-100 signup-btn">
					DODAK 회원가입 완료</button>
				<p class="mt-4">
					<a href="/" class="btn btn-sm btn-outline-secondary"> <i
						class="bi bi-arrow-left me-1"></i> 메인으로 돌아가기
					</a>
				</p>
			</form>
		</div>
	</div>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script src="/js/script.js"></script>
	<script>
		//
		let isIdAvailable = false;
		let isEmailAvailable = false;
        // 아이디 중복 체크 함수 만들 예정
       	let checkId = () => {
       		const id = $('#inputId').val();       		
       		$.ajax({
       			// 작성 순서는 상관 없습니다.
       			url    : "/member/checkId",
       			method : "get",
       			data   : {userId : id},
       			success: function(response){
       				if(!response){
       					console.log(response);
       					// 아이디가 중복 됨
       					$("#idMessage").text("아이디가 중복되었습니다.").css({'color':'blue', 'font-weight':'normal'});
       					isIdAvailable = false;
       				} else {
       					// 아이디가 중복되지 않음
       					$("#idMessage").text("사용 가능한 아이디입니다.").css({'color':'red', 'font-weight':'normal'});
       					isIdAvailable = true;
       					
       				}
       			},
       			error  : function(error){
       				// 통신 실패
       				$("#idMessage").text("통신에러");
       			}       			
       		});
        }
       	
       	let checkEmail = () => {
       		const email = $('#inputEmail').val();       		
       		
       		// ajax Asynchronus Javascript And Xml(비동기 자바스크립트 & XML)
       		// 페이지 이동 없이 빠르고 부드러운 UX 구현을 하기 위해 사용
       		$.ajax({
       			// 작성 순서는 상관 없습니다.
       			url    : "/member/checkEmail",
       			method : "get",
       			data   : {email : email},
       			success: function(response){
       				if(!response){
       					console.log(response);
       					// 아이디가 중복 됨
       					$("#emailMessage").text("이메일이 중복되었습니다.").css({'color':'blue', 'font-weight':'normal'});
       					isEmailAvailable = false;
       				} else {
       					// 아이디가 중복되지 않음
       					$("#emailMessage").text("사용 가능한 이메일입니다.").css({'color':'red', 'font-weight':'normal'});
       					isEmailAvailable = true;
       					
       				}
       			},
       			error  : function(error){
       				// 통신 실패
       				$("#emailMessage").text("통신에러");
       			}       			
       		});
        }
       	
     // 비밀번호 확인 함수 만들 예정
      	$('#inputPasswordConfirm').on("input", function(){
      		const pw = $('#inputPassword').val();
	        const pwConfirm = $('#inputPasswordConfirm').val();
	        const pwMessage = $('#pwMessage');
	        
	        if(pw === pwConfirm) { //값과 자료형이 모두 같은 지 보는 문법	        	
	        	pwMessage.text("일치합니다.").css({'color':'blue', 'font-weight':'normal'});
	        	pwAvailable = true;
	        } else {
	        	pwMessage.text("비밀번호가 서로 다릅니다.").css({'color':'red', 'font-weight':'normal'});
	        	pwAvailable = false;
	        }
	        
	        
      	});
        
        // 폼 태그 제출 검토
        $('#registerForm').on('submit', function(e){        	
        	// 비밀번호 체크
        	const pw = $('#inputPassword').val();
        	const pwConfirm = $('#inputPasswordConfirm').val();
        	
        	checkId();        	
        	if(!isIdAvailable){
        		e.preventDefault();
	        	alert("아이디 중복체크 완료 해주세요.");
	        	return;
	        }
        	
        	if(pw !== pwConfirm) { //값과 자료형이 모두 같은 지 보는 문법
        		console.log("hello");
        		// form 태그 제출 방지 코드
        		e.reventDefault();
	        	alert("비밀번호가 서로 일치하지 않습니다.");	     
	        	return;
	        }
        	
        	
        	isHyphenPhoneNumber();
        	
        	validateEmail();
        	if(!isEmailAvailable){
        		e.preventDefault();
	        	alert("이메일 중복체크 완료 해주세요.");
	        	return;
	        }        	
        	
        	if($('#checkTerms3').is(':checked')) {
        		document.getElementById('agreements').value = "1";
        	} else {
        		document.getElementById('agreements').value = "0";
        	}
        });
        
        $("#buttonPostcodeSearch").on("click",function (e) {
        	e.preventDefault();
        	new daum.Postcode({
                oncomplete: function(data) {
                	// 우편번호
                    $("#zipCode").val(data.zonecode);
                    // 도로명 및 지번주소
                    $("#streetAdr").val(data.roadAddress);
                }
            }).open();      	
        });
        
        function isHyphenPhoneNumber(phone) {  
        	const regex = /^0\d{1,2}-\d{3,4}-\d{4}$/;  
        	return regex.test(phone);
        }
        
        function emailCheck(email_address){     
        	email_regex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i;
        	if(!email_regex.test(email_address)){ 
        		return false; 
        	}else{
        		return true;
        	}
        }
        function validateEmail() {
        	var emailInput = document.getElementById('inputEmail');
        	var resultDiv = document.getElementById('emailMessage');

        	var email = emailInput.value;

        	if (emailCheck(email)) {
        		resultDiv.innerHTML = '유효한 이메일 주소입니다.';
        		checkEmail();
        		return true;
        	} else {
        		resultDiv.innerHTML = '유효하지 않은 이메일 주소입니다.';
        		return false;
        	}
        }
        
        
        $('#checkAllTerms').on("click",function (e) {        	
            $('.form-check-input').prop('checked', this.checked);
        });

        $('.form-check-input').on("change",function (e) {
            if ($('.form-check-input:checked').length === $('.form-check-input').length) {
                $('#checkAllTerms').prop('checked', true);
            } else {            	
                $('#checkAllTerms').prop('checked', false);
            }
        });
        
        
        
        //$('input:checkbox').prop('checked', true);
        //$('input:checkbox').prop('checked', false);
</script>
</body>
</html>