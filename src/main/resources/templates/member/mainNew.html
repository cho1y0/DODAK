<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë‚˜ì˜ ë§ˆìŒ ì¼ê¸°ì¥ (ê°ì„± UI/UX)</title>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<link
	href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/calendar.css">
<script
	src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

	<img src="/img/íœ´ì‹í•˜ëŠ”ë„ë‹¥ì´.png" alt="íœ´ì‹í•˜ëŠ” ë„ë‹¥ì´"
		class="dodak-bg-element dodak-float-1">
	<img src="/img/ì•‰ì•„ì„œë…ì„œí•˜ëŠ”ë„ë‹¥ì´.png" alt="ë…ì„œí•˜ëŠ” ë„ë‹¥ì´"
		class="dodak-bg-element dodak-float-2">
	<img src="/img/ë¬¸ì„œë³´ëŠ”ë„ë‹¥ì´.png" alt="ë¬¸ì„œë³´ëŠ” ë„ë‹¥ì´"
		class="dodak-bg-element dodak-float-3">
	<img src="/img/í™œì§ì›ƒëŠ”ë„ë‹¥ì´.png" alt="ì›ƒëŠ” ë„ë‹¥ì´"
		class="dodak-bg-element dodak-float-4">
	<img src="/img/êµ¬ë¦„ë„ë‹¥ì´.png" alt="êµ¬ë¦„ ìœ„ ë„ë‹¥ì´"
		class="dodak-bg-element dodak-float-5">
	<img src="/img/ìƒê°í•˜ëŠ”ë„ë‹¥ì´.png" alt="ìƒê°í•˜ëŠ” ë„ë‹¥ì´"
		class="dodak-bg-element dodak-float-6">

	<nav
		class="navbar navbar-expand-lg fixed-top custom-navbar shadow-sm show-navbar">
		<div class="container-fluid app-container" id="menucon"
			style="display: none;">

			<button class="navbar-toggler" type="button"
				data-bs-toggle="collapse" data-bs-target="#navbarNav"
				aria-controls="navbarNav" aria-expanded="false"
				aria-label="Toggle navigation" style="border: none;">
				<i class="bi bi-list" style="font-size: 1.8rem; color: #6c757d;"></i>
			</button>

			<div class="collapse navbar-collapse" id="navbarNav">

				<ul class="nav nav-pills me-auto" id="mainTab" role="tablist">
					<li class="nav-item" role="presentation">
						<button class="nav-link custom-nav-link active" id="home-tab"
							data-bs-toggle="tab" data-bs-target="#home-panel" type="button"
							role="tab" aria-controls="home-panel" aria-selected="true">
							<img src="/img/dodak.png" alt="í™ˆ" class="nav-tab-icon"> í™ˆ
						</button>
					</li>
					<li class="nav-item" role="presentation">
						<button class="nav-link custom-nav-link" id="write-tab"
							data-bs-toggle="tab" data-bs-target="#write-panel" type="button"
							role="tab" aria-controls="write-panel" aria-selected="false">
							<img src="/img/ìŒë£Œë¨¹ëŠ”ë„ë‹¥.png" alt="ì‘ì„±" class="nav-tab-icon"
								style="width: 50px;"> ì˜¤ëŠ˜ì˜ ì¼ê¸°ì‘ì„±í•˜ê¸°
						</button>
					</li>
					<li class="nav-item" role="presentation">
						<button class="nav-link custom-nav-link" id="list-tab"
							data-bs-toggle="tab" data-bs-target="#list-panel" type="button"
							role="tab" aria-controls="list-panel" aria-selected="false">
							<img src="/img/ì•‰ì•„ì„œë…ì„œí•˜ëŠ”ë„ë‹¥ì´.png" alt="ë¦¬ìŠ¤íŠ¸" class="nav-tab-icon"
								style="width: 50px;"> ë‚˜ì˜ ì¼ê¸° ë¦¬ìŠ¤íŠ¸
						</button>
					</li>
					<li class="nav-item" role="presentation">
						<button class="nav-link custom-nav-link" id="mypage-tab"
							data-bs-toggle="tab" data-bs-target="#mypage-panel" type="button"
							role="tab" aria-controls="mypage-panel" aria-selected="false">
							<img src="/img/í™œì§ì›ƒëŠ”ë„ë‹¥ì´.png" alt="ë„ë‹¥ì´ ë§ˆì´í˜ì´ì§€ ì•„ì´ì½˜"
								style="height: 24px; width: auto; margin-right: 5px; vertical-align: middle;">
							ë§ˆì´í˜ì´ì§€
						</button>
					</li>
				</ul>
				<div class="d-flex ms-auto">
					<a href="/logout"
						class="btn btn-sm btn-outline-secondary me-2 login-btn"> <i
						class="bi bi-box-arrow-in-right me-1"></i> ë¡œê·¸ì•„ì›ƒ
					</a>
				</div>


			</div>

		</div>
	</nav>

	<div class="app-container">
		<div class="tab-content" id="mainTabContent">

			<div class="tab-pane fade show active" id="home-panel"
				role="tabpanel" aria-labelledby="home-tab">
				<div class="app-card home-intro-card position-relative">
					<h2 class="text-center fw-bold mb-5" style="color: #6c757d;">
						DODAK: ì¼ìƒì„ 'ë„ë‹¥'ì—¬ì£¼ëŠ” ë§ˆìŒ ê¸°ë¡ ì›¹</h2>

					<img src="/img/ìŒë£Œë¨¹ëŠ”ë„ë‹¥.png" alt="ìŒë£Œ ë§ˆì‹œëŠ” ë„ë‹¥ì´"
						class="dodak-local-element dodak-home-corner-1">

					<ul
						class="nav nav-tabs nav-tabs-custom justify-content-center mb-4"
						id="homeTabs" role="tablist">

						<li class="nav-item" role="presentation">
							<button class="nav-link active" id="mascot-tab"
								data-bs-toggle="tab" data-bs-target="#mascot-pane" type="button"
								role="tab" aria-controls="mascot-pane" aria-selected="true">
								<i class="bi bi-emoji-heart-eyes me-2"></i> ë§ˆìŠ¤ì½”íŠ¸ ì†Œê°œ
							</button>
						</li>

						<li class="nav-item" role="presentation">
							<button class="nav-link" id="project-tab" data-bs-toggle="tab"
								data-bs-target="#project-pane" type="button" role="tab"
								aria-controls="project-pane" aria-selected="false">
								<i class="bi bi-journal-text me-2"></i> í”„ë¡œì íŠ¸ ì„¤ëª…
							</button>
						</li>
					</ul>

					<div class="tab-content" id="homeTabContent">



						<div class="tab-pane fade show active" id="mascot-pane"
							role="tabpanel" aria-labelledby="mascot-tab">
							<img src="/img/êµ¬ë¦„ë„ë‹¥ì´.png" alt="ë– ìˆëŠ” ë„ë‹¥ì´"
								class="dodak-local-element"
								style="position: absolute; top: 10px; left: 50px; width: 150px; opacity: 0.85; z-index: 10;">

							<div class="row justify-content-center align-items-center g-4">

								<div class="col-12 col-md-4 d-flex justify-content-center">
									<div class="dodak-main-image-card">
										<img src="/img/í™œì§ì›ƒëŠ”ë„ë‹¥ì´.png" alt="ë„ë‹¥ì´ ë§ˆìŠ¤ì½”íŠ¸"
											class="img-fluid rounded-3 shadow-sm p-2"
											style="max-height: 250px;">
									</div>
								</div>

								<div
									class="col-12 col-md-8 dodak-intro-text text-center text-md-start">
									<h3 class="fw-bold mb-3" style="color: var(--text-color);">
										<span style="color: var(--accent-color);">âœ¨ ë”°ëœ»í•œ ë™í–‰:</span>
										ë§ˆìŠ¤ì½”íŠ¸ ë„ë‹¥ì´ë¥¼ ì†Œê°œí•©ë‹ˆë‹¤!
									</h3>

									<p class="lead" style="color: #6a6a6a; margin-bottom: 1rem;">
										DODAKì˜ ë‹¤ì •í•œ ë§ˆìŠ¤ì½”íŠ¸ **ë„ë‹¥ì´**ê°€ ë‹¹ì‹ ì˜ **ì´ì•¼ê¸°**ë¥¼ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.</p>

									<p style="color: var(--text-color);">ë„ë‹¥ì´ëŠ” í•­ìƒ ì‘ì€ ìŠ¤ì¹´í”„ë¥¼ ë‘ë¥´ê³ 
										ë‹¤ë‹ˆë©°, ì‚¬ìš©ìë‹˜ì˜ **'ë§ˆìŒ ì¼ê¸°'**ë¥¼ ê°€ì¥ ì†Œì¤‘íˆ ì—¬ê¸°ëŠ” ë‹¤ëŒì¥ì…ë‹ˆë‹¤. ë‹¨ìˆœí•œ ê¸°ë¡ì„ ë„˜ì–´, **ê°ì •ì˜
										ë³€í™”**ì™€ **ìˆ¨ê²¨ì§„ ë§ˆìŒì˜ ì†Œë¦¬**ë¥¼ ê·€ ê¸°ìš¸ì—¬ ë“£ëŠ” ê²ƒì´ ë„ë‹¥ì´ì˜ ì¤‘ìš”í•œ ì—­í• ì…ë‹ˆë‹¤.</p>
									<p style="color: var(--text-color);">ë§¤ì¼ì˜ ê¸°ë¡ì„ í†µí•´ ë‹¹ì‹ ì˜ ê°ì •ì„
										ë¶„ì„í•˜ê³ , í•„ìš”í•œ ìˆœê°„ì— **ë”°ëœ»í•œ ë°°ê²½ ìŒì•…**ì´ë‚˜ **ë§ì¶¤í˜• íë§ í…Œë§ˆ**ë¥¼ ì¶”ì²œí•˜ì—¬ ì§€ì¹œ ë§ˆìŒì„ ì–´ë£¨ë§Œì ¸
										ì¤ë‹ˆë‹¤.</p>

									<p class="fw-bold fs-5 mt-4 p-3 rounded-3"
										style="color: #ffffff; background-color: var(--highlight-color);">
										"ì‚¬ìš©ìë‹˜ì˜ ì´ì•¼ê¸°ì— ê·€ ê¸°ìš¸ì—¬<br class="d-md-none"> ì§€ì¹œ í•˜ë£¨ë¥¼ **ë”°ëœ»í•˜ê²Œ
										ë„ë‹¥ì—¬** ë“œë¦´ê²Œìš”."
									</p>
								</div>
							</div>
						</div>


						<div class="tab-pane fade" id="project-pane" role="tabpanel"
							aria-labelledby="project-tab">
							<div class="project-description-section position-relative pt-3">
								<h3 class="fw-bold mb-4 text-center" style="color: #444;">[
									í”„ë¡œì íŠ¸ DODAK ì„¤ëª… ]</h3>

								<img src="/img/ìƒê°í•˜ëŠ”ë„ë‹¥ì´.png" alt="ìƒê°í•˜ëŠ” ë„ë‹¥ì´"
									class="dodak-local-element"
									style="position: absolute; top: -170px; left: 50px; width: 100px; opacity: 0.8; z-index: 10;">

								<div class="row g-4">
									<div class="col-md-4">
										<div class="feature-box">
											<i class="bi bi-pencil-square display-5 mb-2"
												style="color: var(--mood-joy);"></i>
											<h5 class="fw-bold">1. ê°ì • ë§ì¶¤í˜• ê¸°ë¡ í™˜ê²½</h5>
											<p>ì‘ì„±ìì˜ ì¼ê¸° ê°ì •ì„ ë¶„ì„í•˜ì—¬ ì‹¤ì‹œê°„ìœ¼ë¡œ ë§ì¶¤ íë§(ìŒì•…,ì˜ìƒë“±..)ì»¨í…ì¸ ë¥¼ ì œê³µí•˜ì—¬, ì¼ê¸°
												ì‘ì„±ì— ëŒ€í•œ ëª°ì…ê°ì„ ë†’ì—¬ì¤ë‹ˆë‹¤.</p>
										</div>
									</div>

									<div class="col-md-4">
										<div class="feature-box">
											<i class="bi bi-file-earmark-bar-graph display-5 mb-2"
												style="color: var(--bs-info);"></i>
											<h5 class="fw-bold">2. ìƒë‹´ì„ ë¯¸ë¦¬ ë•ëŠ” AI ê¸°ë¡ ë¶„ì„</h5>
											<p>ì¼ê¸° ë‚´ìš©ì„ AIê°€ ê¼¼ê¼¼íˆ ì½ê³  ì¤‘ìš”í•œ ê°ì • í‚¤ì›Œë“œë¥¼ ë¯¸ë¦¬ ì •ë¦¬í•´ ë‘¡ë‹ˆë‹¤. ì§„ë‹¨ ë¦¬í¬íŠ¸ëŠ” ì›”ë³„
												ë³´ê³ ì„œì˜ ê¸°ë°˜ì´ ë˜ì–´, ë‹¹ì‹ ì˜ ë§ˆìŒ ìƒíƒœë¥¼ í•œëˆˆì— íŒŒì•…í•˜ê³  ë” ê¹Šì´ ìˆëŠ” ìƒë‹´ì„ ì¤€ë¹„í•˜ëŠ” ë° í° ë„ì›€ì´
												ë©ë‹ˆë‹¤.</p>
										</div>
									</div>

									<div class="col-md-4">
										<div class="feature-box">
											<i class="bi bi-bar-chart-line display-5 mb-2"
												style="color: var(--mood-regret);"></i>
											<h5 class="fw-bold">3. ì›”ë³„ ê°ì • ë³´ê³ ì„œ ì œê³µ</h5>
											<p>ì •ì‹ ê³¼ ì „ë¬¸ì˜ì—ê²Œ í™˜ìì˜ ì›”ë³„ ê°ì • ë³€í™”ì™€ í†µê³„ë¥¼ ì‹œê°í™”í•˜ì—¬ ì œê³µí•¨ìœ¼ë¡œì¨, í™˜ìì˜ ìƒíƒœë¥¼ ë¹ ë¥´ê²Œ
												íŒŒì•…í•˜ê³  ìƒë‹´ì„ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
										</div>
									</div>
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>

			<div class="tab-pane fade" id="write-panel" role="tabpanel"
				aria-labelledby="write-tab">
				<div class="row">
					<div class="col-12">
						<div class="app-card">
							<h4 class="fw-bold mb-4" style="color: #555;">ì˜¤ëŠ˜ì˜ ê°ì„±ì„ ê¸°ë¡í•´ìš”
								âœï¸</h4>
							<p class="text-muted">ë‚ ì§œ: 2025ë…„ 10ì›” 24ì¼ (ê¸ˆ)</p>
							<div class="mb-4">
								<label for="diaryMood" class="form-label fw-semibold">ì˜¤ëŠ˜ì˜
									ê¸°ë¶„ ì„ íƒ</label>
								<div class="mood-select" id="diaryMood">
									<button class="btn btn-outline-danger me-2" data-mood="ë¶„ë…¸"
										value="ë¶„ë…¸">ë¶„ë…¸ ğŸ”¥</button>
									<button class="btn btn-outline-warning me-2" data-mood="ë¶ˆì•ˆ"
										value="ë¶ˆì•ˆ">ë¶ˆì•ˆ ğŸ˜Ÿ</button>
									<button class="btn btn-outline-primary me-2" data-mood="ìŠ¬í””"
										value="ìŠ¬í””">ìŠ¬í”” ğŸ˜¢</button>
									<button class="btn btn-outline-success me-2" data-mood="ê¸°ì¨"
										value="ê¸°ì¨">ê¸°ì¨ ğŸ˜Š</button>
									<button class="btn btn-outline-info me-2" data-mood="í›„íšŒ"
										value="í›„íšŒ">í›„íšŒ ğŸ˜”</button>
									<button class="btn btn-outline-info me-2" data-mood="í¬ë§"
										value="í›„íšŒ">í¬ë§ âœ¨</button>
									<button class="btn btn-outline-info me-2" data-mood="ì¤‘ë¦½"
										value="í›„íšŒ">ì¤‘ë¦½ ğŸ˜</button>
									<button class="btn btn-outline-info me-2" data-mood="í”¼ë¡œ"
										value="í›„íšŒ">í”¼ë¡œ ğŸ˜´</button>
									<button class="btn btn-outline-info me-2" data-mood="ìš°ìš¸"
										value="í›„íšŒ">ìš°ìš¸ ğŸ’™</button>
								</div>
							</div>
							<div class="mb-4">
								<label for="diaryTitle" class="form-label fw-semibold">ì œëª©</label>
								<input type="text" class="form-control" id="diaryTitle"
									placeholder="ì˜¤ëŠ˜ì˜ ë§ˆìŒì„ ë‹´ì•„ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"> <input
									type="hidden" id="memberId" name="memberId"
									th:value="${session.memberId}"> <input type="hidden"
									id="currentDiaryIdx" name="currentDiaryIdx">

							</div>
							<div class="mb-4">
								<label for="diaryContent" class="form-label fw-semibold">ì˜¤ëŠ˜ì˜
									ì´ì•¼ê¸°</label>
								<textarea class="form-control" id="diaryContent" rows="10"
									placeholder="ì˜¤ëŠ˜ ìˆì—ˆë˜ ì¼ì´ë‚˜ ëŠê¼ˆë˜ ê°ì •ì„ ììœ ë¡­ê²Œ ê¸°ë¡í•´ë³´ì„¸ìš”."></textarea>
							</div>
							<div class="d-flex justify-content-between gap-2 mt-4">
								<button class="btn btn-lg btn-dark w-50" id="saveDiaryBtn">ì¼ê¸°
									ì €ì¥í•˜ê¸°</button>
								<button class="btn btn-lg btn-secondary w-50" type="button"
									data-bs-toggle="collapse"
									data-bs-target="#StatsCollapseYoutube" aria-expanded="false"
									aria-controls="StatsCollapseYoutube">ê¸°ë¶„ì— ë”°ë¥¸ ì¶”ì²œ ì˜ìƒ ëª©ë¡ë³´ê¸°</button>
							</div>
						</div>
					</div>
				</div>
				<div class="collapse" id="StatsCollapseYoutube">
					<div class="row">
						<div class="col-12">
							<div class="today-stats-card position-relative">
								<div class="atti-character"></div>
								<div class="today-stats-content">
									<h5 class="text-center fw-bold mb-4" style="color: #c94f79;">ì˜¤ëŠ˜ì˜
										ê¸°ë¶„ ì„ íƒì— ë§ëŠ” ì˜ìƒ ëª©ë¡</h5>
									<div class="atti-comment-section">
										<div class="atti-title">
											<h5>ë„ë‹¥ì´ê°€ ì¶”ì²œí•´ìš”!</h5>
											<img src="/img/dodak.png" alt="ë„ë‹¥ì´ ì•„ì´ì½˜"
												class="atti-dodak-icon">
										</div>
										<div class="diary-list" id="youtubeResult"></div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="tab-pane fade" id="list-panel" role="tabpanel"
				aria-labelledby="list-tab">
				<div class="row">
					<div class="col-12">
						<div class="app-card position-relative">
							<h4 class="fw-bold mb-4" style="color: #555;">ê¸°ë¡ëœ ë‚˜ì˜ ì¼ê¸° ëª¨ìŒ
								ğŸ“š</h4>
							<p class="text-muted mb-4"></p>

							<img src="/img/íœ´ì‹í•˜ëŠ”ë„ë‹¥ì´.png" alt="íœ´ì‹í•˜ëŠ” ë„ë‹¥ì´"
								class="dodak-local-element dodak-list-search-1">

							<div class="d-flex align-items-center mb-4 gap-2">
								<div class="controls">
									<div class="col">
										<label for="yearSearch">ì—°ë„ ê²€ìƒ‰ / ì„ íƒ</label>
										<div class="search">
											<input id="yearSearch" type="search"
												placeholder="ì˜ˆ: 1990 ë˜ëŠ” 20" aria-label="ì—°ë„ ê²€ìƒ‰" />
										</div>
										<div id="yearList" class="list" role="listbox"
											aria-label="ì—°ë„ ëª©ë¡" tabindex="0"></div>
									</div>

									<div class="col">
										<label for="monthSearch">ì›” ê²€ìƒ‰ / ì„ íƒ</label> <input
											id="monthSearch" type="search" placeholder="ì˜ˆ: 3 ë˜ëŠ” 03"
											aria-label="ì›” ê²€ìƒ‰" />
										<div id="monthList" class="list" role="listbox"
											aria-label="ì›” ëª©ë¡" tabindex="0"></div>
									</div>

									<div class="col">
										<label for="daySearch">ì¼ ê²€ìƒ‰ / ì„ íƒ</label> <input id="daySearch"
											type="search" placeholder="ì˜ˆ: 15 ë˜ëŠ” 1" aria-label="ì¼ ê²€ìƒ‰" />
										<div id="dayList" class="list" role="listbox" tabindex="0"
											aria-label="ì¼ ëª©ë¡"></div>
									</div>
								</div>

								<div class="output" aria-live="polite">
									<strong id="selected">ì—†ìŒ</strong>
								</div>
								<div class="input-group ms-auto"
									style="max-width: 290px; height: 60px; padding-top: 20px;">
									<input type="text" class="form-control form-control-sm"
										placeholder="ì œëª©/ë‚´ìš© ê²€ìƒ‰">
									<button class="btn btn-secondary btn-sm" type="button">
										<i class="bi bi-search"></i>
									</button>
								</div>
							</div>
							<input type="hidden" id="waitChk" value="0">
							<div class="diary-list"></div>
						</div>
					</div>
				</div>
			</div>
			
			<div class="tab-pane fade" id="mypage-panel">
				<div class="container">
					<ul class="nav nav-tabs sub-nav-tabs" id="myPageInnerTab"
						role="tablist">
						<li class="nav-item" role="presentation">
							<button class="nav-link active" id="info-tab"
								data-bs-toggle="tab" data-bs-target="#info-pane" type="button"
								role="tab" aria-controls="info-pane" aria-selected="true">
								ê¸°ë³¸ì •ë³´ ìˆ˜ì •</button>
						</li>						
					</ul>
					<div class="tab-content pt-3" id="myPageInnerTabContent">

						<div class="tab-pane fade show active" id="info-pane"
							role="tabpanel" aria-labelledby="info-tab" tabindex="0">
							<form id="registerForm">
								<input type="hidden" id="agreements" name="agreementYn" value="">
								<input type="hidden" id="oldImgPath" name="oldImgPath" value="">
								<div class="header-section-wrapper"></div>

								<div class="form-section">
									<h3 class="section-title">
										<i class="fas fa-user"></i> ê¸°ë³¸ ì •ë³´
									</h3>
									<div class="grid-2">
										<div class="form-group">
											<div class="profile-section">
												<div class="profile-image-container"
													id="profileImageContainer" align="center">
													<img
														src="https://placehold.co/120/DCC5AE/FFFFFF?text=PROFILE"
														alt="í”„ë¡œí•„ ì´ë¯¸ì§€" style="width: 100%; height: 100%"
														class="profile-image"> <input type="file"
														id="profileImageUpload" name="profileImage"
														accept="image/*" style="display: none;">
													<div class="overlay">í´ë¦­í•˜ì—¬ ì´ë¯¸ì§€ ë³€ê²½</div>
												</div>
											</div>
										</div>
										<div class="form-group">
											<label for="roleSelect" class="required">ê°€ì… ì—­í• </label> <select
												id="roleSelect" name="role" class="form-control"
												disabled="disabled">
												<option value="USER">ì¼ë°˜ íšŒì› (USER)</option>
												<option value="DOCTOR">ì˜ì‚¬ íšŒì› (DOCTOR)</option>
											</select>
										</div>
										<div class="form-group">
											<label for="userId" class="required">ì•„ì´ë””</label>
											<div class="input-group">
												<input type="text" readonly="readonly" id="inputId"
													name="userId" class="form-control" placeholder="ID ì…ë ¥"
													maxlength="20" autocomplete="off">
												<button type="button" class="btn btn-secondary"
													id="buttonIDCheck" disabled="disabled" onclick="checkId()">ì¤‘ë³µ
													ì²´í¬</button>
											</div>
											<span class="help-text">5~20ì, ì˜ë¬¸+ìˆ«ì ì¡°í•©.</span> <small
												id="idMessage" class="form-text text-muted"></small>
										</div>
										<div class="form-group">
											<label for="name" class="required">ì´ë¦„ (í•œê¸€)</label> <input
												type="text" id="inputName" name="name" class="form-control"
												placeholder="ì‹¤ëª… ì…ë ¥ (í•œê¸€)" maxlength="10" required="required">
										</div>

										<div class="form-group">
											<label for="password" class="required">ë¹„ë°€ë²ˆí˜¸</label> <input
												type="password" name="password" class="form-control"
												maxlength="20" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" required>
											<small class="help-text">8~20ì, ì˜ë¬¸+ìˆ«ì+íŠ¹ìˆ˜ë¬¸ì ì¡°í•©.</small>
										</div>
										<div class="form-group">
											<label for="passwordConfirm" class="required">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
											<input type="password" name="passwordConfirm"
												class="form-control" id="passwordConfirm"
												placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥" maxlength="20" required="required">
											<small class="help-text" id="passwordMatchText"></small>
										</div>
									</div>
								</div>

								<div class="form-section">
									<h3 class="section-title">
										<i class="fas fa-mobile-alt"></i> ì—°ë½ ì •ë³´
									</h3>
									<div class="grid-2">
										<div class="form-group">
											<label for="phone" class="required">íœ´ëŒ€ ì „í™”</label> <input
												type="tel" class="form-control" id="inputPhone" name="phone"
												placeholder="010-XXXX-XXXX" required="required">
										</div>
										<div class="form-group">
											<label for="email" class="required">ì´ë©”ì¼</label>
											<div class="input-group">
												<input type="email" class="form-control" id="inputEmail"
													name="email" placeholder="example@dodak.com"
													required="required">
												<button type="button" class="btn btn-secondary"
													onclick="validateEmail()" id="buttonEmailCheck">ì¤‘ë³µ
													ì²´í¬</button>
											</div>
											<small class="help-text">ì´ë©”ì¼ í˜•ì‹ ê²€ì¦ ë° ì¤‘ë³µ ë¶ˆê°€.</small> <small
												class="help-text" id="emailMessage"></small>

										</div>
									</div>
								</div>

								<div class="form-section">
									<h3 class="section-title">
										<i class="fas fa-home"></i> ì£¼ì†Œ ì •ë³´
									</h3>
									<div class="grid-2">
										<div class="form-group">
											<label for="zipCode" class="required">ìš°í¸ ë²ˆí˜¸</label>
											<div class="input-group">
												<input type="text" class="form-control" id="zipCode"
													placeholder="ìš°í¸ë²ˆí˜¸" name="zipCode" readonly required>
												<button type="button" class="btn btn-secondary"
													id="buttonPostcodeSearch">ê²€ìƒ‰</button>
											</div>
										</div>
										<div class="form-group">
											<label for="addr1" class="required">ì£¼ì†Œ</label> <input
												type="text" class="form-control" id="streetAdr" name="addr1"
												placeholder="ë„ë¡œëª… ì£¼ì†Œ" readonly required>
										</div>
									</div>
									<div class="form-group">
										<label for="addr2">ìƒì„¸ ì£¼ì†Œ</label> <input type="text"
											class="form-control" id="inputAddressDetail" name="addr2"
											placeholder="ìƒì„¸ ì£¼ì†Œ (ì„ íƒ ì…ë ¥)">
									</div>
								</div>

								<div class="form-section" id="doctorInfoSection"
									style="display: none;">
									<h3 class="section-title">
										<i class="fas fa-hospital-alt"></i> ì˜ì‚¬ ì •ë³´
									</h3>
									<div class="grid-2">
										<div class="form-group">
											<label for="hospitalName" class="required">ì†Œì† ë³‘ì›</label>
											<div class="input-group">
												<input type="text" id="hospNameDisplay" class="form-control"
													placeholder="ë³‘ì› ì„ íƒ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”" readonly> <input
													type="hidden" id="hospIdx" name="hospIdx">
												<button type="button" class="btn btn-primary"
													id="openHospitalModalBtn">ë³‘ì› ì„ íƒ/ì¶”ê°€</button>
											</div>
										</div>
										<div class="form-group">
											<label for="specialty" class="required">ì „ë¬¸ ë¶„ì•¼</label> <input
												type="text" id="inputSpecialty" name="specialty"
												class="form-control" placeholder="ì˜ˆ: ì •ì‹  ê±´ê°•ì˜í•™ê³¼">
										</div>
									</div>
								</div>

								<div class="form-section agreement-section">
									<h3 class="section-title">
										<i class="fas fa-file-alt"></i> ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹  ë™ì˜
									</h3>
									<div class="grid-2 agreement-checkboxes">

										<div class="form-group">
											<input type="checkbox" id="checkTerms3"> <span
												class="checkbox-text">ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹  ë™ì˜ (ì´ë©”ì¼/SMS) (ì„ íƒ)</span>
										</div>
									</div>
								</div>

								<div class="footer-actions" style="width: 100%" align="center">
									<button class="btn btn-submit-small" id="regBtn">íšŒì› ì •ë³´
										ìˆ˜ì •</button>

								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div id="hospitalModal" class="modal">
		<div class="modal-content">
			<span class="close-button">&times;</span>
			<h3 class="modal-title">
				<i class="fas fa-hospital"></i> ë³‘ì› ê²€ìƒ‰ ë° ì¶”ê°€
			</h3>

			<div class="search-hospital-section">
				<h4 class="sub-section-title">ë³‘ì› ê²€ìƒ‰</h4>
				<div class="form-group">
					<label for="hospitalSearchInput" class="required">ë³‘ì› ì´ë¦„ìœ¼ë¡œ
						ê²€ìƒ‰</label>
					<div class="input-group">
						<input type="text" id="hospitalSearchInput" class="form-control"
							placeholder="ì˜ë£Œì›">
						<button type="button" class="btn btn-secondary"
							id="searchHospitalBtn">ê²€ìƒ‰</button>
					</div>
				</div>
				<div id="hospitalSearchResults" class="search-results"></div>
			</div>

			<div class="add-hospital-section">
				<h4 class="sub-section-title">ë³‘ì› ë“±ë¡/ìˆ˜ì •</h4>
				<p>ì°¾ëŠ” ë³‘ì›ì´ ì—†ìœ¼ì‹ ê°€ìš”? ì§ì ‘ ë“±ë¡í•´ë³´ì„¸ìš”.</p>
				<button type="button" class="btn btn-primary"
					id="openAddHospitalFormBtn">ë³‘ì› ì •ë³´ ì…ë ¥</button>

				<div id="newHospitalForm" class="new-hospital-form"
					style="display: none;">
					<h5>ë³‘ì› ì •ë³´ ì…ë ¥</h5>
					<div class="grid-2">
						<div class="form-group">
							<label for="newHospitalName" class="required">ë³‘ì›ëª…</label> <input
								type="text" id="newHospitalName" name="newHospitalName"
								class="form-control" placeholder="ë³‘ì› ì´ë¦„"> <input
								type="hidden" id="newHospitalId" name="newHospitalId"
								class="form-control">
						</div>
						<div class="form-group">
							<label for="newHospitalTel" class="required">ëŒ€í‘œ ì „í™”ë²ˆí˜¸</label> <input
								type="text" id="newHospitalTel" name="newHospitalTel"
								class="form-control" placeholder="02-XXXX-XXXX ë˜ëŠ” 010-XXXX-XXXX"
								required>
						</div>
						<div class="form-group">
							<label for="newHospitalZipCode" class="required">ìš°í¸ ë²ˆí˜¸</label>
							<div class="input-group">
								<input type="text" id="newHospitalZipCode"
									name="newHospitalZipCode" class="form-control"
									placeholder="ìš°í¸ë²ˆí˜¸" readonly>
								<button type="button" class="btn btn-secondary"
									id="searchNewHospitalZipCodeBtn">ê²€ìƒ‰</button>
							</div>
						</div>
						<div class="form-group full-width">
							<label for="newHospitalAddr1" class="required">ì£¼ì†Œ</label> <input
								type="text" id="newHospitalAddr1" name="newHospitalAddr1"
								class="form-control" placeholder="ê¸°ë³¸ ì£¼ì†Œ" readonly>
						</div>
						<div class="form-group full-width">
							<label for="newHospitalAddr2">ìƒì„¸ ì£¼ì†Œ</label> <input type="text"
								id="newHospitalAddr2" name="newHospitalAddr2"
								class="form-control" placeholder="ìƒì„¸ ì£¼ì†Œ ì…ë ¥">
						</div>
					</div>

					<div class="new-hospital-form-actions">
						<button type="button" class="btn btn-primary"
							id="saveNewHospitalBtn">ì €ì¥</button>
						<button type="button" class="btn btn-secondary"
							id="cancelAddHospitalBtn">ì·¨ì†Œ</button>
					</div>
				</div>
			</div>

			<button type="button" class="btn btn-secondary"
				id="closeHospitalModalBtn">íŒì—… ë‹«ê¸°</button>
		</div>
	</div>
	<div class="modal fade" id="diaryDetailModal" tabindex="-1"
				aria-labelledby="diaryDetailModalLabel" aria-hidden="true">
				<div class="modal-dialog modal-lg">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="diaryDetailModalLabel"></h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"
								aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<p class="text-muted mb-3" id="modal-date-info"></p>

							<div id="modal-diary-content"
								style="max-height: 400px; overflow-y: auto; padding: 10px; border: 1px solid #eee; border-radius: 5px;">
							</div>

							<h6 class="mt-4 border-bottom pb-1">AI ë¶„ì„ ê²°ê³¼</h6>
							<div id="modal-analysis-result"></div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary"
								data-bs-dismiss="modal">ë‹«ê¸°</button>
						</div>
					</div>
				</div>
			</div>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script src="/js/scriptNew.js"></script>
	<script src="/js/calendar.js"></script>

	<script>
		let keyword = "";
		const buttonContainer = document.getElementById('diaryMood');
		//2. ë¶€ëª¨ divì— í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
		buttonContainer.addEventListener('click', function(event) {
			// 3. ì‹¤ì œë¡œ í´ë¦­ëœ ìš”ì†Œ(event.target)ê°€ ë²„íŠ¼(BUTTON)ì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.
			if (event.target.tagName === 'BUTTON') {
				// 4. í´ë¦­ëœ ë²„íŠ¼ì˜ value ì†ì„± ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
				const selectedValue = event.target.value;
				
				const waitChk = document.getElementById('waitChk');
				
				
				if (waitChk.value == 0) {
					document.getElementById('waitChk').value = 1;
					
					keyword = selectedValue;					
					$.ajax({
						url : "http://192.168.0.5:8000/youtube/search",
						method : "POST",
						contentType : "application/json",
						data : JSON.stringify({
							keyword : keyword
						}),
						success : function(result) {
							console.log(result);
							const tbody = $("#youtubeResult").empty();							
							const data = result.results;
							let keywordSet = keyword;
							if(keyword=='ë¶„ë…¸') {
								keywordSet += "ğŸ”¥";
							} else if(keyword=='ë¶ˆì•ˆ') {
								keywordSet += "ğŸ˜Ÿ";
							} else if(keyword=='ê¸°ì¨') {
								keywordSet += "ğŸ˜Š";
							} else if(keyword=='ìŠ¬í””') {
								keywordSet += "ğŸ˜¢";
							} else if(keyword=='í›„íšŒ') {
								keywordSet += "ğŸ˜”";
							} else if(keyword=='í¬ë§') {
								keywordSet += "âœ¨";
							} else if(keyword=='ì¤‘ë¦½') {
								keywordSet += "ğŸ˜";
							} else if(keyword=='í”¼ë¡œ') {
								keywordSet += "ğŸ˜´";
							} else if(keyword=='ìš°ìš¸') {								
								keywordSet += "ğŸ’™";
							} else {
								keywordSet += "ğŸ”¥";
							}
							data.forEach((board,idx) => {
								tbody.append(`<div class="diary-item-card mood-${keyword}" onclick="window.open('${board.link}', 'íë§ì¼€ì–´', 'width=600,height=320');">
										<div
										class="d-flex justify-content-between align-items-start">
										<h5 class="fw-bold mb-1">${board.name}</h5>
										<span class="diary-mood-tag mood-${keyword}">${keywordSet}</span>
									</div>
									<p class="text-muted mb-2" style="font-size: 0.9em;">${board.videoDate}
										| ${board.viewCount}</p>
									<p class="mb-0 text-truncate">${board.videoDescript}</p>
								</div>`);
							});
							document.getElementById('waitChk').value = 0;
						},
						
					});
				} else {
					alert("[" + keyword	+ "]ì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤.\nì™„ë£Œê°€ ë˜ë©´ ë‹¤ì‹œ ì„ íƒí•´ ì£¼ì‹­ì‹œì˜¤.")
				}

			}
		});
		
		// ì—¬ê¸°ì— JavaScript ì½”ë“œ ì¶”ê°€
		const customNavbar = document.querySelector('.custom-navbar');
		let menucon = document.getElementById("menucon");

		if (customNavbar) {
		    // í˜ì´ì§€ ë¡œë“œ ì‹œì—ëŠ” ìˆ¨ê¹€ ìƒíƒœ (CSSê°€ ì²˜ë¦¬)

		    // mouseover (ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¸ì„ ë•Œ) ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
		    customNavbar.addEventListener('mouseover', function() {
		        // show-navbar í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•˜ì—¬ ë„¤ë¹„ê²Œì´ì…˜ì„ ë³´ì´ê²Œ í•©ë‹ˆë‹¤.        
		        menucon.style.display= "block";
		    });

		    // mouseout (ë§ˆìš°ìŠ¤ë¥¼ ë–¼ì—ˆì„ ë•Œ) ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
		    customNavbar.addEventListener('mouseout', function() {
		        // show-navbar í´ë˜ìŠ¤ë¥¼ ì œê±°í•˜ì—¬ ë„¤ë¹„ê²Œì´ì…˜ì„ ìˆ¨ê¹ë‹ˆë‹¤.        
		    	menucon.style.display= "none";
		    });
		}
		
			
	</script>
	<script>
	// 1. ê¸°ë¶„ ì„ íƒ ìƒíƒœ ê´€ë¦¬ (Active Mood Tracking)
    let selectedMood = null;

    
    
    // í˜„ì¬ ë‚ ì§œ í‘œì‹œ ì—…ë°ì´íŠ¸ (ì˜ˆì‹œ)
    const today = new Date();
    const dateString = `${today.getFullYear()}ë…„ ${today.getMonth() + 1}ì›” ${today.getDate()}ì¼ (${['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][today.getDay()]})`;
    // .app-card p.text-muted ëŠ” <div class="tab-pane fade" id="write-panel"> ë‚´ë¶€ì— ìˆëŠ” p íƒœê·¸ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
    $('#write-panel .app-card p.text-muted').text(`ë‚ ì§œ: ${dateString}`);


    // ê¸°ë¶„ ë²„íŠ¼ ì„ íƒ ì‹œ ìŠ¤íƒ€ì¼ ë³€ê²½ ë° ê°’ ì €ì¥
    $('#diaryMood button').on('click', function() {
        // ëª¨ë“  ë²„íŠ¼ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
        $('#diaryMood button').removeClass('active btn-mood-selected');
        // ì„ íƒëœ ë²„íŠ¼ì— active í´ë˜ìŠ¤ ì¶”ê°€
        $(this).addClass('active btn-mood-selected');
        selectedMood = $(this).data('mood'); // data-mood ì†ì„± ê°’ ì‚¬ìš©
    });

 
    
    // 2. ì¼ê¸° ì €ì¥ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    $('#saveDiaryBtn').on('click', function() {
    	if ($currentDiaryIdx.value==='' || $currentDiaryIdx.value===0) {
    		// POST ìš”ì²­ìœ¼ë¡œ ì €ì¥ API í˜¸ì¶œ
            console.log('POST');
            callSaveDiaryApi();
        } else {
        	// PUT ìš”ì²­ìœ¼ë¡œ ìˆ˜ì • API í˜¸ì¶œ
            console.log('PUT');
            callUpdateDiaryApi($currentDiaryIdx.value);
        }
        
    });
    
    function callSaveDiaryApi(){
    	const diaryTitle = $('#diaryTitle').val().trim();
        const diaryContent = $('#diaryContent').val().trim();
        const memberId = $('#memberId').val();
        
        if (!diaryTitle || !diaryContent) {
            alert("ì œëª©ê³¼ ì˜¤ëŠ˜ì˜ ì´ì•¼ê¸°ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        // ì „ì†¡í•  ë°ì´í„° ê°ì²´ êµ¬ì„±
        const dataToSend = {
        	memberId : memberId,
            diaryTitle: diaryTitle,
            diaryContent: diaryContent,            
            // íŒŒì¼ ì²¨ë¶€ í•„ë“œê°€ ìˆë‹¤ë©´ ì—¬ê¸°ì— ì¶”ê°€ (í˜„ì¬ëŠ” null)
            file1: null,
            file2: null,
            file3: null
        };
        
        // ë¡œë”© ìƒíƒœ í‘œì‹œ
        $('#saveDiaryBtn').prop('disabled', true).text('ì¼ê¸° ì €ì¥ ë° AI ë¶„ì„ ì¤‘...');
		//console.log(JSON.stringify(dataToSend));
        $.ajax({
            url: "/api/diaries",
            type: "POST", // ì¼ê¸° ìƒì„±ì„ ìœ„í•œ POST ë°©ì‹ ì‚¬ìš©
            contentType: "application/json", // JSONìœ¼ë¡œ ì „ì†¡
            data: JSON.stringify(dataToSend),
            success: function(savedDiary, status, xhr) {
                // ì„±ê³µì ì¸ ì‘ë‹µ (ì¼ë°˜ì ìœ¼ë¡œ 201 Created)
                //console.log("ìƒˆ ì¼ê¸° ì €ì¥ ì™„ë£Œ:", savedDiary);
                
                // 10ì´ˆ ëŒ€ê¸°ê°€ ìˆìœ¼ë¯€ë¡œ ì ì ˆí•œ ë©”ì‹œì§€ë¥¼ í‘œì‹œ
                alert("ìƒˆë¡œìš´ ì¼ê¸° ì €ì¥ì´ ì™„ë£Œë˜ì—ˆìœ¼ë©°, AI ë¶„ì„ì„ ìš”ì²­í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ 'í†µê³„' íƒ­ì—ì„œ ê²°ê³¼ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
                
                // ì„±ê³µ í›„ ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                $('#diaryTitle').val('');
                $('#diaryContent').val('');
                $('#diaryMood button').removeClass('active btn-mood-selected');
                selectedMood = null;

                // í†µê³„ íƒ­ ë“±ìœ¼ë¡œ ì „í™˜ ìœ ë„ (ì˜ˆì‹œ)
                // $('#stats-tab').tab('show'); 
            },
            error: function(xhr, status, error) {
                console.error("ì—ëŸ¬ ë°œìƒ:", error);
                // ì„œë²„ì—ì„œ ë³´ë‚¸ ì—ëŸ¬ ë©”ì‹œì§€(JSON)ê°€ ìˆë‹¤ë©´ íŒŒì‹±í•˜ì—¬ í‘œì‹œ
                const errorMsg = xhr.responseJSON ? xhr.responseJSON.message : "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
                alert("ì¼ê¸° ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + errorMsg);
            },
            complete: function() {
                // ë²„íŠ¼ ìƒíƒœ ë³µêµ¬
                $('#saveDiaryBtn').prop('disabled', false).text('ì¼ê¸° ì €ì¥í•˜ê¸°');
            }
        });
    }
	
	</script>
	<script>
    // âš ï¸ [í•„ìˆ˜ ì„¤ì •] ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ID (PK)ë¥¼ ì„œë²„ í…œí”Œë¦¿ ì—”ì§„ì„ í†µí•´ ë°›ì•„ì™€ì•¼ í•©ë‹ˆë‹¤.
    // ì˜ˆ: Thymeleaf/JSPë¥¼ ì‚¬ìš©í•˜ì—¬ <input type="hidden" id="loggedInMemberId" value="123"> ì™€ ê°™ì´ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.
    // ì—¬ê¸°ì„œëŠ” IDë¥¼ ê°€ì§„ hidden inputì´ ìˆë‹¤ê³  ê°€ì •í•˜ê³  ê°’ì„ ê°€ì ¸ì˜¤ê±°ë‚˜, ì„ì‹œë¡œ 1ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
    const MEMBER_ID = document.getElementById('memberId') ? 
                      document.getElementById('memberId').value : 
                      '1'; // í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ì„ì‹œë¡œ '1' ì‚¬ìš©
    
    const DIARY_PAGE_SIZE = 4; // í•œ í˜ì´ì§€ë‹¹ ì¼ê¸° ê°œìˆ˜ (Controller ì„¤ì •ê³¼ ì¼ì¹˜í•´ì•¼ í•¨)

    // DOM ìš”ì†Œ ìºì‹œ
    const $listPanel = document.getElementById('list-panel');
    const $diaryListContainer = $listPanel.querySelector('.diary-list');
    
    // ê¸°ì¡´ ë”ë¯¸ ëª©ë¡ ë° í˜ì´ì§• ì˜ì—­ì„ ë¹„ì›ë‹ˆë‹¤.
    $diaryListContainer.innerHTML = '';
    $diaryListContainer.insertAdjacentHTML('afterend', '<nav aria-label="Diary Pagination" class="mt-4"><ul class="pagination justify-content-center"></ul></nav>');
    
    const $paginationNav = $listPanel.querySelector('nav[aria-label="Diary Pagination"] ul');
    
    // ê²€ìƒ‰ ì…ë ¥ í•„ë“œì™€ ë²„íŠ¼ì— IDê°€ ì—†ìœ¼ë¯€ë¡œ ì¿¼ë¦¬ ì„ íƒìë¥¼ ì‚¬ìš©í•˜ê³  IDë¥¼ í• ë‹¹í•©ë‹ˆë‹¤.
    const $keywordSearch = $listPanel.querySelector('.input-group input[type="text"]');
    const $searchButton = $listPanel.querySelector('.input-group button');
    $keywordSearch.id = 'keywordSearch'; 
    $searchButton.id = 'searchButton'; 

    const $yearSearch = document.getElementById('yearSearch');
    const $monthSearch = document.getElementById('monthSearch');
    const $daySearch = document.getElementById('daySearch');
    const $totalDiaryCount = $listPanel.querySelector('p.text-muted');
    
 	// ìŠ¤í¬ë¦½íŠ¸ ìƒë‹¨ì— ëª¨ë‹¬ ì¸ìŠ¤í„´ìŠ¤ ë° DOM ìš”ì†Œ ì •ì˜ (Bootstrap 5 ê°€ì •)
 	//const $diaryDetailModal = document.getElementById('diaryDetailModal')
    const diaryDetailModal = new bootstrap.Modal(document.getElementById('diaryDetailModal'));
    const $modalTitle = document.getElementById('diaryDetailModalLabel');
    const $modalDateInfo = document.getElementById('modal-date-info');
    const $modalContent = document.getElementById('modal-diary-content');
    const $modalAnalysisResult = document.getElementById('modal-analysis-result');
    
 	// ìŠ¤í¬ë¦½íŠ¸ ìƒë‹¨ (ê¸°ì¡´ ìºì‹œ ì˜ì—­ì— ì¶”ê°€)
    const $writePanel = document.getElementById('write-panel');
    const $diaryMoodContainer = document.getElementById('diaryMood'); // ê¸°ë¶„ ì„ íƒ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ
    
    const $currentDiaryIdx = document.getElementById('currentDiaryIdx');
    const $diaryTitle = document.getElementById('diaryTitle');
    const $diaryContent = document.getElementById('diaryContent');
    const $dateDisplay = $writePanel.querySelector('p.text-muted'); // ë‚ ì§œ í‘œì‹œ ì˜ì—­ (ì˜ˆ: "ë‚ ì§œ: 2025ë…„ 10ì›” 24ì¼ (ê¸ˆ)")
    
    
    
    /**
     * ì¼ê¸° í•­ëª©ì— í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ë°”ì¸ë”©í•˜ê³  ëª¨ë‹¬ì„ ë„ì›ë‹ˆë‹¤.
     * @param {Array<Object>} diaries - í˜„ì¬ í˜ì´ì§€ì— í‘œì‹œëœ ì¼ê¸° ë°ì´í„° ëª©ë¡
     */
    function bindDiaryClickEvents(diaries) {
        const cards = document.querySelectorAll('.diary-item-card');
        cards.forEach(card => {
            card.addEventListener('click', function() {
                const diaryIdx = this.dataset.idx;
                const diaryData = diaries.find(d => String(d.diaryIdx) === diaryIdx); // í˜„ì¬ í´ë¦­ëœ ì¼ê¸° ë°ì´í„° ì°¾ê¸°
                
                if (diaryData) {
                    fillModalWithData(diaryData);
                    diaryDetailModal.show(); // ëª¨ë‹¬ í‘œì‹œ
                    
                }
            });
        });
    }

    // --- 1. ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ ---

    /**
     * ì¼ê¸° ëª©ë¡ì„ ì„œë²„ì—ì„œ AJAXë¡œ ê°€ì ¸ì™€ í™”ë©´ì— ê·¸ë¦½ë‹ˆë‹¤.
     * @param {number} page - ìš”ì²­í•  í˜ì´ì§€ ë²ˆí˜¸ (0ë¶€í„° ì‹œì‘)
     */
    async function loadDiaries(page = 0) {
        if (!MEMBER_ID) return;
        
        $diaryListContainer.innerHTML = '<p class="text-center text-info py-5">ì¼ê¸° ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';

        const keyword = $keywordSearch.value.trim();
        const year = $yearSearch.value.trim();
        const month = $monthSearch.value.trim();
        const day = $daySearch.value.trim();

        // ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° êµ¬ì„±
        const params = new URLSearchParams({
            page: page,
            size: DIARY_PAGE_SIZE            
        });
        
        
        const bodyData = {
                year: year,
                month: month,
                day: day,
                keyword: keyword
            };

        const url = `/api/diaries/list/${MEMBER_ID}?${params.toString()}`;

        try {
        	const response = await fetch(url, {
                method: 'POST', // â­ï¸ POST ë©”ì„œë“œ ì‚¬ìš©
                headers: {
                    'Content-Type': 'application/json' // â­ï¸ JSON í˜•ì‹ ì§€ì •
                },
                body: JSON.stringify(bodyData) // â­ï¸ ê²€ìƒ‰ ì¡°ê±´ì„ JSON ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì—¬ ë³¸ë¬¸ì— í¬í•¨
            });
            if (!response.ok) {
                throw new Error(`HTTP Error: ${response.status}`);
            }
            const pageData = await response.json();
            console.log("pageData content : " + JSON.stringify(pageData.content));
            // UI ì—…ë°ì´íŠ¸
            renderDiaryList(pageData.content);
            renderPagination(pageData.page);
            
            $totalDiaryCount.textContent = `ì´ ${pageData.page.totalElements}ê°œì˜ ì¼ê¸°ê°€ ê¸°ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤.`;
         // â­ï¸â­ï¸â­ï¸ ìƒˆë¡œ ì¶”ê°€ëœ ë¶€ë¶„: ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë°”ì¸ë”© â­ï¸â­ï¸â­ï¸
			
            bindDiaryClickEvents(pageData.content);
        } catch (error) {
            console.error("ì¼ê¸° ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:", error);
            $diaryListContainer.innerHTML = `<p class="text-danger text-center py-5">ì¼ê¸° ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>`;
            $paginationNav.innerHTML = '';
        }
    }

    // --- 2. ëª©ë¡ ë Œë”ë§ í•¨ìˆ˜ ---

    /**
     * ì¼ê¸° ëª©ë¡ ë°ì´í„°ë¥¼ HTMLë¡œ ë³€í™˜í•˜ì—¬ ì¶œë ¥í•©ë‹ˆë‹¤.
     */
    function renderDiaryList(diaries) {
        if (diaries.length === 0) {
            $diaryListContainer.innerHTML = '<p class="text-center text-muted mt-5">ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ì¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }

        const html = diaries.map(diary => {
            // â­ ì„œë²„ ì—”í‹°í‹°ì˜ í•„ë“œëª…ê³¼ ì¼ì¹˜ì‹œì¼œì•¼ í•©ë‹ˆë‹¤.
            // aiResultMood í•„ë“œê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ 'ê¸°ë¡' ì‚¬ìš© (ì‹¤ì œ êµ¬í˜„ ì‹œ ë¶„ì„ ê²°ê³¼ í•„ë“œ ì‚¬ìš©)
             
            
            // ë‚ ì§œ í¬ë§·íŒ… (2025.10.20 í˜•ì‹ìœ¼ë¡œ ë§ì¶¤)            
            const diaryDate = new Date(diary.createdAt).toLocaleDateString('ko-KR', {
                year: 'numeric', month: '2-digit', day: '2-digit', weekday: "long" , hour: "2-digit" , minute: "2-digit" 
            }).replace(/\. /g, '.').replace(/\.$/, '');
            // Note: ë‚ ì”¨ ì •ë³´ëŠ” Diary ì—”í‹°í‹°ì— weather í•„ë“œê°€ ìˆë‹¤ë©´ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
            
            const moods = [];
            moods.push(diary.anxietyRatio);
            moods.push(diary.sadnessRatio)
            moods.push(diary.joyRatio)
            moods.push(diary.angerRatio)
            moods.push(diary.regretRatio);
            moods.push(diary.hopeRatio);            
            moods.push(diary.tirednessRatio);
            moods.push(diary.depressionRatio);
            moods.push(diary.neutralityRatio);
            
            const maxValue = Math.max(...moods); // ì „ê°œ êµ¬ë¬¸(...)ì„ ì‚¬ìš©í•˜ì—¬ ë°°ì—´ ìš”ì†Œë¥¼ ì¸ìˆ˜ë¡œ ì „ë‹¬
            //const mood = diary.aiResultMood || 'ê¸°ë¡';
            //console.log("moods = " +JSON.stringify(moods));
            let mood = 'ê¸°ë¡';
         	// 2. í•´ë‹¹ ìµœëŒ€ê°’ì˜ ì²« ë²ˆì§¸ ìœ„ì¹˜(ì¸ë±ìŠ¤) ì°¾ê¸°
         	const maxIndex = moods.indexOf(maxValue); 
         	if(maxIndex==0) {
         		mood = "ë¶ˆì•ˆ";
         	} else if(maxIndex==1) {
         		mood = "ìŠ¬í””";
         	} else if(maxIndex==2) {
         		mood = "ê¸°ì¨";
         	} else if(maxIndex==3) {
         		mood = "ë¶„ë…¸";
         	} else if(maxIndex==4) {
         		mood = "í›„íšŒ";
         	} else if(maxIndex==5) {
         		mood = "í¬ë§";
         	} else if(maxIndex==6) {
         		mood = "í”¼ë¡œ";
         	} else if(maxIndex==7) {
         		mood = "ìš°ìš¸";
         	} else if(maxIndex==8) {         	
         		mood = "ì¤‘ë¦½";
         	} else {
         		mood = "ê¸°ë¡";
         	}
         	const moodEmoji = getMoodEmoji(mood);         	
            return `
                <div class="diary-item-card mood-${mood}" data-idx="${diary.diaryIdx}">
                    <div class="d-flex justify-content-between align-items-start">
                        <h5 class="fw-bold mb-1">${diary.diaryTitle}</h5>
                        <span class="diary-mood-tag mood-${mood}">${mood} ${moodEmoji}</span>
                    </div>
                    <p class="text-muted mb-2" style="font-size: 0.9em;">${diaryDate}</p>
                    <p class="mb-0 text-truncate">${diary.diaryContent}</p>
                </div>
            `;
        }).join('');

        $diaryListContainer.innerHTML = html;
    }

    // --- 3. í˜ì´ì§• ë Œë”ë§ í•¨ìˆ˜ ---

    /**
     * APIì—ì„œ ë°›ì€ í˜ì´ì§• ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Pagination UIë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
     */
    function renderPagination(pageData) {
    	const { number, totalPages } = pageData; // firstì™€ lastëŠ” undefinedì¼ ìˆ˜ ìˆìŒ.

        // â­ï¸ firstì™€ lastë¥¼ numberì™€ totalPagesë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê³„ì‚°í•˜ì—¬ ëŒ€ì²´í•©ë‹ˆë‹¤.
        const first = (number === 0);
        const last = (number === totalPages - 1);        
        $paginationNav.innerHTML = '';
        if (totalPages <= 1) return;

        // í˜ì´ì§€ ë¸”ë¡ ì„¤ì • (5ê°œ)
        const displayPageCount = 5;
        let startPage = Math.max(0, number - Math.floor(displayPageCount / 2));
        let endPage = Math.min(totalPages - 1, startPage + displayPageCount - 1);
        
        if (endPage - startPage < displayPageCount - 1) {
            startPage = Math.max(0, endPage - displayPageCount + 1);
        }

        // 'ì´ì „' ë²„íŠ¼
        const prevClass = first ? 'page-item disabled' : 'page-item';
        $paginationNav.innerHTML += `<li class="${prevClass}"><a class="page-link" href="#" data-page="${number - 1}">ì´ì „</a></li>`;

        // í˜ì´ì§€ ë²ˆí˜¸
        for (let i = startPage; i <= endPage; i++) {
            const activeClass = (i === number) ? 'page-item active' : 'page-item';
            $paginationNav.innerHTML += `
                <li class="${activeClass}">
                    <a class="page-link" href="#" data-page="${i}">${i + 1}</a>
                </li>
            `;
        }

        // 'ë‹¤ìŒ' ë²„íŠ¼
        const nextClass = last ? 'page-item disabled' : 'page-item';
        $paginationNav.innerHTML += `<li class="${nextClass}"><a class="page-link" href="#" data-page="${number + 1}">ë‹¤ìŒ</a></li>`;
    }

    /**
     * ê°ì • ì´ë¦„ì— ë”°ë¥¸ ì´ëª¨í‹°ì½˜ì„ ë°˜í™˜í•©ë‹ˆë‹¤. (ì˜ˆì‹œ)
     */
    function getMoodEmoji(mood) {
        switch (mood) {
            case 'ê¸°ì¨': return 'ğŸ˜Š';
            case 'ë¶ˆì•ˆ': return 'ğŸ˜Ÿ';
            case 'ë¶„ë…¸': return 'ğŸ˜¡';
            case 'ìŠ¬í””': return 'ğŸ˜¥';
            case 'í›„íšŒ': return 'ğŸ˜”';
            case 'í¬ë§': return 'âœ¨';
            case 'ì¤‘ë¦½': return 'ğŸ˜';
            case 'í”¼ë¡œ': return 'ğŸ˜´';
            case 'ìš°ìš¸': return 'ğŸ’™';
            
            default: return 'ğŸ—’ï¸';
        }
    }
    
    // --- 4. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---

    // 1. í˜ì´ì§• ë²„íŠ¼ í´ë¦­ ì‹œ
    $listPanel.addEventListener('click', (e) => {
        const target = e.target.closest('.page-link');
        if (target) {
            e.preventDefault();
            const page = target.dataset.page;
            if (page !== undefined && !target.closest('.page-item').classList.contains('disabled')) {
                loadDiaries(parseInt(page));
            }
        }
    });

    // 2. ê²€ìƒ‰ ë° ë‚ ì§œ í•„í„° ë³€ê²½/í´ë¦­ ì‹œ ì²« í˜ì´ì§€(0) ë¡œë“œ
    const searchInputs = [$yearSearch, $monthSearch, $daySearch, $keywordSearch];
    
    // ë‚ ì§œ/í‚¤ì›Œë“œ ì…ë ¥ í•„ë“œ ë³€ê²½ ì‹œ
    searchInputs.forEach(input => {
        if (input) {
            input.addEventListener('change', () => loadDiaries(0));
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    loadDiaries(0);
                }
            });
        }
    });

    // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ
    if ($searchButton) {
    	
        $searchButton.addEventListener('click', () => loadDiaries(0));
    }


    // --- 5. ì´ˆê¸° ë¡œë“œ ---
    document.addEventListener('DOMContentLoaded', () => {
        if (MEMBER_ID) {
            // DOMContentLoaded ì‹œì ì´ ì•„ë‹Œ, íƒ­ì´ í™œì„±í™”ë˜ëŠ” ì‹œì ì— í˜¸ì¶œí•˜ëŠ” ê²ƒì´ ë” íš¨ìœ¨ì ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            // ì—¬ê¸°ì„œëŠ” DOM ë¡œë“œ í›„ ë°”ë¡œ í˜¸ì¶œí•©ë‹ˆë‹¤.
            //loadDiaries(0); 
            loadTodayDiary();
        } else {
            $diaryListContainer.innerHTML = '<p class="text-danger text-center">ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
        }
    });
    
    function fillModalWithData(diary) {
        // 1. ë‚ ì§œ í¬ë§·íŒ… (ê¸¸ê²Œ ìƒì„¸ ì •ë³´ í‘œì‹œ)
        const dateString = diary.createdAt.replace(/\+00:00$/, 'Z');
        const dateObject = new Date(dateString); 
        
        const detailedDate = dateObject.toLocaleString('ko-KR', {
            year: 'numeric', month: '2-digit', day: '2-digit', 
            weekday: "long", hour: "2-digit", minute: "2-digit", second: "2-digit"
        });
        
        // 2. ëª¨ë‹¬ DOM ìš”ì†Œì— ë°ì´í„° ì±„ìš°ê¸°
        $modalTitle.textContent = diary.diaryTitle;
        $modalDateInfo.innerHTML = `
            <span class="badge bg-primary me-2">ì‘ì„±ì: ${diary.memberName || 'ë¯¸í™•ì¸'}</span>
            <span class="badge bg-secondary">${detailedDate}</span>
        `;
        $modalContent.textContent = diary.diaryContent; // ë‚´ìš©ì„ í…ìŠ¤íŠ¸ë¡œ ì‚½ì…
        
     	// 3. AI ë¶„ì„ ê²°ê³¼ ì±„ìš°ê¸°
        let analysisHtml = '<p class="text-muted">ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        if (diary.modelName) { // modelName í•„ë“œê°€ ìˆìœ¼ë©´ ë¶„ì„ ê²°ê³¼ê°€ ìˆë‹¤ê³  ê°€ì •
            analysisHtml = `
                <p><strong>ëª¨ë¸:</strong> ${diary.modelName}</p>                
                <h6>ê°ì • ë¹„ìœ¨ (%)</h6>
                <ul class="list-unstyled d-flex flex-wrap">
                    <li class="me-3">ë¶ˆì•ˆ: <strong>${diary.anxietyRatio || 0}%</strong></li>
                    <li class="me-3">ìŠ¬í””: <strong>${diary.sadnessRatio || 0}%</strong></li>
                    <li class="me-3">ê¸°ì¨: <strong>${diary.joyRatio || 0}%</strong></li>
                    <li class="me-3">ë¶„ë…¸: <strong>${diary.angerRatio || 0}%</strong></li>
                    <li class="me-3">í›„íšŒ: <strong>${diary.regretRatio || 0}%</strong></li>
                    <li class="me-3">í¬ë§: <strong>${diary.hopeRatio || 0}%</strong></li>
                    <li class="me-3">ì¤‘ë¦½: <strong>${diary.neutralityRatio || 0}%</strong></li>
                    <li class="me-3">í”¼ê³¤: <strong>${diary.tirednessRatio || 0}%</strong></li>
                    <li class="me-3">ìš°ìš¸: <strong>${diary.depressionRatio || 0}%</strong></li>
                </ul>
            `;
        }
        $modalAnalysisResult.innerHTML = analysisHtml;
    }
    
 // --- 6. ì˜¤ëŠ˜ ì¼ê¸° ë¡œë“œ ë° í¼ ì±„ìš°ê¸° í•¨ìˆ˜ ---

    let currentDiaryIdx = null; // ìˆ˜ì • ì‹œ ì‚¬ìš©í•  ê¸°ì¡´ ì¼ê¸°ì˜ ID (ì—†ìœ¼ë©´ null)

    /**
     * ì˜¤ëŠ˜ ì‘ì„±ëœ ì¼ê¸°ê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  í¼ì„ ì±„ì›ë‹ˆë‹¤.
     */
    async function loadTodayDiary() {
        if (!MEMBER_ID || MEMBER_ID === '1') return; // í…ŒìŠ¤íŠ¸ ID '1'ì¼ ê²½ìš° ìš”ì²­í•˜ì§€ ì•ŠìŒ

        try {
            const url = `/api/diaries/today/${MEMBER_ID}`;
            const response = await fetch(url, { method: 'GET' });

            if (response.ok) {
                const diaryData = await response.json();
                fillWriteForm(diaryData); // ë°ì´í„°ê°€ ìˆìœ¼ë©´ í¼ ì±„ìš°ê¸°
                console.log("ì˜¤ëŠ˜ì˜ ì¼ê¸° ë°ì´í„° ë¡œë“œ ì™„ë£Œ.");
            } else if (response.status === 404) {
                // ì¼ê¸°ê°€ ì—†ëŠ” ê²½ìš°, í¼ ì´ˆê¸°í™” ìƒíƒœë¡œ ìœ ì§€
                console.log("ì˜¤ëŠ˜ ì‘ì„±ëœ ì¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆ ì¼ê¸° ì‘ì„±.");
                resetWriteForm();
            } else {
                throw new Error(`HTTP Error: ${response.status}`);
            }
        } catch (error) {
            console.error("ì˜¤ëŠ˜ ì¼ê¸° ë¡œë“œ ì‹¤íŒ¨:", error);
        }
    }

    /**
     * APIì—ì„œ ë°›ì€ ë°ì´í„°ë¡œ ì¼ê¸° ì‘ì„± í¼ì„ ì±„ìš°ê³  ìˆ˜ì • ëª¨ë“œë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
     */
    function fillWriteForm(diary) {
        // 1. ì¼ê¸° ID ì €ì¥ (ìˆ˜ì •/ì €ì¥ ë²„íŠ¼ ë¡œì§ì— ì‚¬ìš©ë¨)
        $currentDiaryIdx.value = diary.diaryIdx;
        
        // 2. ì œëª©ê³¼ ë‚´ìš© ì±„ìš°ê¸°
        $diaryTitle.value = diary.diaryTitle;
        $diaryContent.value = diary.diaryContent;
        
        // 3. ê¸°ë¶„ ë²„íŠ¼ ì„ íƒ (ë¶„ì„ëœ ì£¼ìš” ê°ì • ë˜ëŠ” ì‚¬ìš©ìê°€ ì§ì ‘ ê¸°ë¡í•œ ê°ì •)
        // í˜„ì¬ DTOì—ëŠ” ì‚¬ìš©ìê°€ ì„ íƒí•œ ê°ì • í•„ë“œ(ì˜ˆ: selectedMood)ê°€ ì—†ë‹¤ê³  ê°€ì •í•˜ê³ ,
        // *ë¶„ì„ëœ ê°ì •* ì¤‘ ê°€ì¥ ë†’ì€ ë¹„ìœ¨ì„ ê°€ì§„ ê°ì •ì„ ì„ íƒí•˜ëŠ” ë¡œì§ì„ ì‚¬ìš©í•˜ê±°ë‚˜,
        // (ë” ì •í™•í•˜ê²ŒëŠ”) ì„œë²„ì—ì„œ ì €ì¥ëœ `selectedMood` ê°’ì„ ë°›ì•„ì™€ì•¼ í•©ë‹ˆë‹¤.
        
        // **ì„ì‹œ: ê¸°ë¶„ ì„ íƒ ë¡œì§ (í•„ìš”ì‹œ êµ¬í˜„)**
        // const selectedMood = getDominantMood(diary); // ê°€ì¥ ë†’ì€ ë¹„ìœ¨ ê°ì • ì¶”ì¶œ í•¨ìˆ˜ ê°€ì •
        // selectMoodButton(selectedMood); // í•´ë‹¹ ë²„íŠ¼ì„ í™œì„±í™”í•˜ëŠ” í•¨ìˆ˜ ê°€ì •
        
        // 4. ì €ì¥ ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½ (ìˆ˜ì • ëª¨ë“œ ì•Œë¦¼)
        const $saveButton = document.getElementById('saveDiaryBtn');
        if ($saveButton) {
            $saveButton.textContent = 'ì¼ê¸° ìˆ˜ì •í•˜ê¸°';
            $saveButton.classList.add('btn-warning');
            $saveButton.classList.remove('btn-dark');
        }
    }

    /**
     * í¼ ì´ˆê¸°í™” í•¨ìˆ˜ (ìƒˆ ì¼ê¸° ì‘ì„± ëª¨ë“œë¡œ ì „í™˜)
     */
    function resetWriteForm() {
    	$currentDiaryIdx.value = null;
        $diaryTitle.value = '';
        $diaryContent.value = '';
        
        // ê¸°ë¶„ ë²„íŠ¼ ì´ˆê¸°í™” ë¡œì§ (ëª¨ë“  active í´ë˜ìŠ¤ ì œê±°) í•„ìš”
        
        const $saveButton = document.getElementById('saveDiaryBtn');
        if ($saveButton) {
            $saveButton.textContent = 'ì¼ê¸° ì €ì¥í•˜ê¸°';
            $saveButton.classList.remove('btn-warning');
            $saveButton.classList.add('btn-dark');
        }
    }
    
 // --------------------------------------------------------------------------
 // â­ï¸ ì¼ê¸° ìˆ˜ì • (PUT)
 // --------------------------------------------------------------------------
 async function callUpdateDiaryApi(diaryIdx) {
     if (!diaryIdx) {
         console.error("ìˆ˜ì •í•  ì¼ê¸° ID(diaryIdx)ê°€ ì—†ìŠµë‹ˆë‹¤.");
         return;
     }
     
     const diaryTitle = $('#diaryTitle').val().trim();
     const diaryContent = $('#diaryContent').val().trim();
     const memberId = $('#memberId').val();
     
     if (!diaryTitle || !diaryContent) {
         alert("ì œëª©ê³¼ ì˜¤ëŠ˜ì˜ ì´ì•¼ê¸°ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
         return;
     }

     // ì „ì†¡í•  ë°ì´í„° ê°ì²´ êµ¬ì„±
     const dataToSend = {
     	memberId : memberId,
         diaryTitle: diaryTitle,
         diaryContent: diaryContent,            
         // íŒŒì¼ ì²¨ë¶€ í•„ë“œê°€ ìˆë‹¤ë©´ ì—¬ê¸°ì— ì¶”ê°€ (í˜„ì¬ëŠ” null)
         file1: null,
         file2: null,
         file3: null
     };
     
     // ë¡œë”© ìƒíƒœ í‘œì‹œ
     $('#saveDiaryBtn').prop('disabled', true).text('ì¼ê¸° ì €ì¥ ë° AI ë¶„ì„ ì¤‘...');
		//console.log(JSON.stringify(dataToSend));
     $.ajax({
         url: `/api/diaries/${diaryIdx}`,
         type: "PUT", // ì¼ê¸° ìƒì„±ì„ ìœ„í•œ POST ë°©ì‹ ì‚¬ìš©
         contentType: "application/json", // JSONìœ¼ë¡œ ì „ì†¡
         data: JSON.stringify(dataToSend),
         success: function(savedDiary, status, xhr) {
             // ì„±ê³µì ì¸ ì‘ë‹µ (ì¼ë°˜ì ìœ¼ë¡œ 201 Created)
             //console.log("ìƒˆ ì¼ê¸° ì €ì¥ ì™„ë£Œ:", savedDiary);
             
             // 10ì´ˆ ëŒ€ê¸°ê°€ ìˆìœ¼ë¯€ë¡œ ì ì ˆí•œ ë©”ì‹œì§€ë¥¼ í‘œì‹œ
             alert("ìƒˆë¡œìš´ ì¼ê¸° ì €ì¥ì´ ì™„ë£Œë˜ì—ˆìœ¼ë©°, AI ë¶„ì„ì„ ìš”ì²­í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ 'í†µê³„' íƒ­ì—ì„œ ê²°ê³¼ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
             
             // ì„±ê³µ í›„ ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
             $('#diaryTitle').val('');
             $('#diaryContent').val('');
             $('#diaryMood button').removeClass('active btn-mood-selected');
             selectedMood = null;

             // í†µê³„ íƒ­ ë“±ìœ¼ë¡œ ì „í™˜ ìœ ë„ (ì˜ˆì‹œ)
             // $('#stats-tab').tab('show'); 
         },
         error: function(xhr, status, error) {
             console.error("ì—ëŸ¬ ë°œìƒ:", error);
             // ì„œë²„ì—ì„œ ë³´ë‚¸ ì—ëŸ¬ ë©”ì‹œì§€(JSON)ê°€ ìˆë‹¤ë©´ íŒŒì‹±í•˜ì—¬ í‘œì‹œ
             const errorMsg = xhr.responseJSON ? xhr.responseJSON.message : "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
             alert("ì¼ê¸° ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + errorMsg);
         },
         complete: function() {
        	 
        	 alert('ğŸ“ ì¼ê¸°ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
             
             // ìˆ˜ì • í›„, ìˆ˜ì •ëœ ë‚´ìš©ì„ í¼ì— ë‹¤ì‹œ ë°˜ì˜í•˜ê±°ë‚˜ (loadTodayDiary)
             // ì‚¬ìš©ìì—ê²Œ ë©”ì‹œì§€ë¥¼ ë³´ì—¬ì£¼ê³  í¼ì„ ìœ ì§€í•©ë‹ˆë‹¤.
             loadTodayDiary(); 
             // ë²„íŠ¼ ìƒíƒœ ë³µêµ¬
             $('#saveDiaryBtn').prop('disabled', false).text('ì¼ê¸° ì €ì¥í•˜ê¸°');
         }
     });
 }
</script>
	<script>
	
		// í¼ ìš”ì†Œ ë° ë²„íŠ¼ ë³€ìˆ˜ ì •ì˜ (ê¸°ì¡´ ì½”ë“œë¥¼ ë”°ë¦„)
		const $form = document.getElementById('registerForm');
		const $inputId = document.getElementById('inputId');
		const $inputName = document.getElementById('inputName');
		const $inputPhone = document.getElementById('inputPhone');
		const $inputEmail = document.getElementById('inputEmail');
		const $zipCode = document.getElementById('zipCode');
		const $streetAdr = document.getElementById('streetAdr');
		const $inputAddressDetail = document.getElementById('inputAddressDetail');
		const $roleSelect = document.getElementById('roleSelect');
		const $doctorInfoSection = document.getElementById('doctorInfoSection');
		
		// ì˜ì‚¬ ì •ë³´ ê´€ë ¨ í•„ë“œ (ìˆ˜ì • ì‹œ í•„ìš”)
		const $hospNameDisplay = document.getElementById('hospNameDisplay');
		const $hospIdx = document.getElementById('hospIdx');
		const $inputSpecialty = document.getElementById('inputSpecialty');

		// ë¹„ë°€ë²ˆí˜¸ í•„ë“œ (ìˆ˜ì • ì‹œì—ëŠ” ë³´í†µ ë¹„ì–´ìˆê³ , ì…ë ¥ ì‹œì—ë§Œ ì—…ë°ì´íŠ¸ë¨)
		const $password = document.getElementById('password');
		const $passwordConfirm = document.getElementById('passwordConfirm');
		
		
		const roleSelect = document.getElementById('roleSelect');
		const doctorInfoSection = document.getElementById('doctorInfoSection');
		const passwordInput = document.getElementById('password');
		const passwordConfirmInput = document.getElementById('passwordConfirm');
		const passwordMatchText = document.getElementById('passwordMatchText');
		const newHospitalId = document.getElementById('newHospitalId');
		const newHospitalName = document.getElementById('newHospitalName');
		const newHospitalTel = document.getElementById('newHospitalTel');
		const newHospitalZipCode = document.getElementById('newHospitalZipCode');
		const newHospitalAddr1 = document.getElementById('newHospitalAddr1');
		const newHospitalAddr2 = document.getElementById('newHospitalAddr2');
		// ì•½ê´€ ë™ì˜ ê´€ë ¨ ìš”ì†Œ
		const agreeAllCheckbox = document.getElementById('agreeAll');
		const allAgreementCheckboxes = document.querySelectorAll('.agreement-checkboxes input[type="checkbox"]');
		// ëª¨ë‹¬ ê´€ë ¨ ìš”ì†Œ
		const openHospitalModalBtn = document.getElementById('openHospitalModalBtn');
		const hospitalModal = document.getElementById('hospitalModal');
		const closeHospitalModalBtns = document.querySelectorAll('#hospitalModal .close-button, #closeHospitalModalBtn');
		const openAddHospitalFormBtn = document.getElementById('openAddHospitalFormBtn');
		const newHospitalForm = document.getElementById('newHospitalForm');
		const cancelAddHospitalBtn = document.getElementById('cancelAddHospitalBtn');
		
		// â­ï¸â­ï¸ ìƒˆë¡œ ì¶”ê°€ëœ ë³‘ì› ê²€ìƒ‰/ì ìš© ê´€ë ¨ ìš”ì†Œ â­ï¸â­ï¸
		const searchHospitalBtn = document.getElementById('searchHospitalBtn');
		const hospitalSearchResults = document.getElementById('hospitalSearchResults');
		const hospitalNameInput = document.getElementById('hospNameDisplay');
		const hospitalIdInput = document.getElementById('hospIdx');
	
		// â­ï¸ ì´ˆê¸° ë¡œë“œ ì‹œ ëª¨ë‹¬ì„ ëª…ì‹œì ìœ¼ë¡œ ìˆ¨ê¹€ (ìœ ì§€)
	  	hospitalModal.style.display = 'none';	  	
	
	  	// --- í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ (ìœ ì§€) ---
	  	const profileImageContainer = document.getElementById('profileImageContainer');
	  	const profileImageUpload = document.getElementById('profileImageUpload');

	   profileImageContainer.addEventListener('click', () => {
	       profileImageUpload.click();
	   });

	   profileImageUpload.addEventListener('change', (event) => {
	       const file = event.target.files[0];
	       if (file) {
	           const reader = new FileReader();
	           reader.onload = function(e) {
	               profileImageContainer.querySelector('.profile-image').src = e.target.result;
	           };
	           reader.readAsDataURL(file);
	       }
	   });

	   // --- ì—­í•  ì„ íƒì— ë”°ë¥¸ 'ì˜ì‚¬ ì •ë³´' ì„¹ì…˜ í† ê¸€ (ìœ ì§€) ---
	   function toggleDoctorInfo() {
	       if (roleSelect.value === 'DOCTOR') {
	           doctorInfoSection.style.display = 'block';
	       } else {
	           doctorInfoSection.style.display = 'none';
	       }
	   }
	   roleSelect.addEventListener('change', toggleDoctorInfo);
	   toggleDoctorInfo();

	   function checkPasswordMatch() {
	       const password = passwordInput.value;
	       const confirmPassword = passwordConfirmInput.value;

	       if (confirmPassword === '') {
	           passwordMatchText.textContent = '';
	           // ì´ˆê¸° ë©”ì‹œì§€ëŠ” íšŒìƒ‰ ë„ì›€ë§ í…ìŠ¤íŠ¸ì™€ êµ¬ë³„ë˜ë¯€ë¡œ ìƒ‰ìƒ ì´ˆê¸°í™”ëŠ” ë¶ˆí•„ìš”
	           return;
	       }

	       if (password === confirmPassword) {
	           passwordMatchText.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.';
	           // â­ï¸ í™”ë©´ ì„¤ê³„ì„œì— ê°€ê¹ê²Œ íŒŒë€ìƒ‰ ê³„ì—´ë¡œ ë³€ê²½ â­ï¸
	           passwordMatchText.style.color = '#007bff'; 
	       } else {
	           passwordMatchText.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
	           // â­ï¸ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë³€ê²½ â­ï¸
	           passwordMatchText.style.color = '#dc3545'; 
	       }
	   }
	   passwordInput.addEventListener('keyup', checkPasswordMatch);
	   passwordConfirmInput.addEventListener('keyup', checkPasswordMatch);

	   closeHospitalModalBtns.forEach(btn => {
	       btn.addEventListener('click', () => {
	           hospitalModal.style.display = 'none';
	           newHospitalForm.style.display = 'none';
	       });
	   });

	   window.addEventListener('click', (event) => {
	       if (event.target == hospitalModal) {
	           hospitalModal.style.display = 'none';
	           newHospitalForm.style.display = 'none';
	       }
	   });

	   // 'ìƒˆ ë³‘ì› ì •ë³´ ë“±ë¡' ë²„íŠ¼ í´ë¦­ ì‹œ í¼ í‘œì‹œ (ìœ ì§€)
	   openAddHospitalFormBtn.addEventListener('click', () => {
		   newHospitalId.value = ''
           newHospitalName.value = ''
           newHospitalZipCode.value= ''
           newHospitalAddr1.value= ''
           newHospitalAddr2.value= ''
           newHospitalTel.value = ''
	       newHospitalForm.style.display = 'block';
	   });

	   cancelAddHospitalBtn.addEventListener('click', () => {
	       newHospitalForm.style.display = 'none';
	   });

	</script>
	<script>
	// script.js
	$.fn.serializeObject = function() {
		var obj = new Object();
		var arr = this.serializeArray();
		arr.forEach(function(data, index) {
			obj[data.name] = data.value;
		})
		return obj;
	}
	
	
	
		let isIdAvailable = false;
		let isEmailAvailable = true;
        
        // **ìƒˆë¡œ ì¶”ê°€ëœ ë³€ìˆ˜**
    	let isDoctor = false;
        
        // ì•„ì´ë”” ì¤‘ë³µ ì²´í¬ í•¨ìˆ˜
       	let checkId = () => {
       		const id = $('#inputId').val();       		
       		$.ajax({
       			url    : "/api/members/checkId",
       			method : "get",      
       			data   : {userId : id},
       			success: function(response){
       				if(!response){
       					// ì•„ì´ë””ê°€ ì¤‘ë³µ ë¨
       					$("#idMessage").text("ì•„ì´ë””ê°€ ì¤‘ë³µë˜ì—ˆìŠµë‹ˆë‹¤.").css({'color':'blue', 'font-weight':'normal'});
       					isIdAvailable = false;
       				} else {
       					// ì•„ì´ë””ê°€ ì¤‘ë³µë˜ì§€ ì•ŠìŒ
       					$("#idMessage").text("ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.").css({'color':'red', 'font-weight':'normal'});
       					isIdAvailable = true;
       					
       				}
       			},
       			error  : function(error){
       				// í†µì‹  ì‹¤íŒ¨
       				$("#idMessage").text("í†µì‹ ì—ëŸ¬");
       			}       			
       		});
        }
       	
       	let checkEmail = () => {
       		const email = $('#inputEmail').val();       		
       		
       		$.ajax({
       			url    : "/api/members/checkEmail",
       			method : "get",
       			data   : {email : email},
       			success: function(response){
       				if(!response){
       					// ì´ë©”ì¼ì´ ì¤‘ë³µ ë¨
       					$("#emailMessage").text("ì´ë©”ì¼ì´ ì¤‘ë³µë˜ì—ˆìŠµë‹ˆë‹¤.").css({'color':'blue', 'font-weight':'normal'});
       					isEmailAvailable = false;
       				} else {
       					// ì´ë©”ì¼ì´ ì¤‘ë³µë˜ì§€ ì•ŠìŒ
       					$("#emailMessage").text("ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë©”ì¼ì…ë‹ˆë‹¤.").css({'color':'red', 'font-weight':'normal'});
       					isEmailAvailable = true;
       					
       				}
       			},
       			error  : function(error){
       				// í†µì‹  ì‹¤íŒ¨
       				$("#emailMessage").text("í†µì‹ ì—ëŸ¬");
       			}       			
       		});
        }
        // í¼ íƒœê·¸ ì œì¶œ ê²€í† 
        $('#regBtn').on('click', function(e){        	
        	e.preventDefault();
        	// 2. ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ í™•ì¸
        	const pw = $('#password').val();
        	const pwConfirm = $('#passwordConfirm').val();
        	if(pw.length>0 && pwConfirm.length>0 ){
	        	if(pw !== pwConfirm) { 
	        		e.preventDefault();
		        	alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì„œë¡œ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");	     
		        	return;
		        }
        	}
        	
        	// 3. ì „í™”ë²ˆí˜¸ í˜•ì‹ í™•ì¸ (ê¸°ì¡´ í•¨ìˆ˜ëŠ” ë°˜í™˜ê°’ë§Œ ìˆê³  í˜¸ì¶œì´ ì—†ì—ˆìŒ)
        	if (!isHyphenPhoneNumber($('#inputPhone').val())) {
                e.preventDefault();
                alert("íœ´ëŒ€ì „í™”ë²ˆí˜¸ í˜•ì‹ì„ í™•ì¸í•´ ì£¼ì„¸ìš”. (010-XXXX-XXXX)");
                return;
            }
        	
        	
        	
        	if(!isEmailAvailable){ // ì¤‘ë³µ ì²´í¬ ê²°ê³¼ í™•ì¸
        		e.preventDefault();
        		// 4. ì´ë©”ì¼ ìœ íš¨ì„± ë° ì¤‘ë³µ í™•ì¸
            	if(!validateEmail()){ // validateEmail()ì´ false ë°˜í™˜í•˜ë©´ í˜•ì‹ ì˜¤ë¥˜
            		e.preventDefault();
    	        	alert("ìœ íš¨í•œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
    	        	return;
    	        }
	        }
            
            // 5. DOCTOR í•„ë“œ í•„ìˆ˜ ê²€ì‚¬ ì¶”ê°€
            if (isDoctor) {
                if ($('#hospIdx').val() === '' || $('#inputSpecialty').val() === '') {
                    e.preventDefault();
                    alert("ì˜ì‚¬ íšŒì›ì€ ë³‘ì› ì„ íƒê³¼ ì „ë¬¸ ë¶„ì•¼ ì…ë ¥ì´ í•„ìˆ˜ì…ë‹ˆë‹¤.");
                    return;
                }
            }
        	// 6. ë§ˆì¼€íŒ… ì •ë³´ ë™ì˜ ì²˜ë¦¬
        	if($('#checkTerms3').is(':checked')) {
        		document.getElementById('agreements').value = "Y";
        	} else {
        		document.getElementById('agreements').value = "N";
        	}
        	
        	const form = document.getElementById('registerForm');
        	
        	// 1. FormData ê°ì²´ë¥¼ í¼ ìš”ì†Œë¡œë¶€í„° ì§ì ‘ ìƒì„±í•©ë‹ˆë‹¤.
        	// ì´ë ‡ê²Œ í•˜ë©´ ì¼ë°˜ í•„ë“œì™€ íŒŒì¼ í•„ë“œê°€ ëª¨ë‘ í¬í•¨ë©ë‹ˆë‹¤.
        	const formData = new FormData(form);
        	formData.append('id',MEMBER_ID);
        	formData.append('role',"USER");
        	       
        	 $.ajax({
        		  url: "/api/members/update",
        		  type: "PUT",
        		  processData: false,
        		  contentType: false,
        		  data: formData,
        		  success: function(savedMember, status, xhr) {
        		    if (xhr.status === 201) {
        		    	alert(`íšŒì› ì •ë³´ ìˆ˜ì • ì™„ë£Œ! íšŒì› ì´ë¦„: ${savedMember.name}`);
        		    	loadMemberData(`${savedMember.id}`);
        		    } else {
						alert("íšŒì› ìˆ˜ì • ì‹¤íŒ¨: " + xhr.status);
        		    }
        		  },
        		  error: function(xhr, status, error) {
        		    console.error("ì—ëŸ¬ ë°œìƒ:", error);
        		    alert("ì •ë³´ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        		  }
        		}); 
        });        
        // ì£¼ì†Œ ê²€ìƒ‰
        $("#buttonPostcodeSearch").on("click",function (e) {
        	e.preventDefault();
        	new daum.Postcode({
                oncomplete: function(data) {
                	// ìš°í¸ë²ˆí˜¸
                    $("#zipCode").val(data.zonecode);
                    // ë„ë¡œëª… ì£¼ì†Œ
                    $("#streetAdr").val(data.roadAddress);
                }
            }).open();      	
        });
        
        // ì „í™”ë²ˆí˜¸ í˜•ì‹ ê²€ì‚¬
        function isHyphenPhoneNumber(phone) {  
        	const regex = /^0\d{1,2}-\d{3,4}-\d{4}$/;  
        	return regex.test(phone);
        }
        
        // ì´ë©”ì¼ í˜•ì‹ ê²€ì‚¬
        function emailCheck(email_address){     
        	email_regex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i;
        	if(!email_regex.test(email_address)){ 
        		return false; 
        	}else{
        		return true;
        	}
        }
        
        // ì´ë©”ì¼ ìœ íš¨ì„± ê²€ì‚¬ ë° ì¤‘ë³µ ì²´í¬ í•¨ìˆ˜ í˜¸ì¶œ
        function validateEmail() {
        	var emailInput = document.getElementById('inputEmail');
        	var resultDiv = document.getElementById('emailMessage');

        	var email = emailInput.value;

        	if (emailCheck(email)) {
        		resultDiv.innerHTML = 'ìœ íš¨í•œ ì´ë©”ì¼ ì£¼ì†Œì…ë‹ˆë‹¤.';
        		checkEmail(); // ìœ íš¨í•˜ë©´ ì¤‘ë³µ ì²´í¬ í˜¸ì¶œ
        		return true;
        	} else {
        		resultDiv.innerHTML = 'ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ ì£¼ì†Œì…ë‹ˆë‹¤.';
        		isEmailAvailable = false; // í˜•ì‹ ì˜¤ë¥˜ ì‹œ ì¤‘ë³µ ê°€ëŠ¥ì„±ë„ falseë¡œ
        		return false;
        	}
        }
        
        // =======================================================
        // ** [ë³‘ì› ì„ íƒ/ì¶”ê°€ íŒì—…] ë° [ì—­í•  ì„ íƒ] ë¡œì§ ì¶”ê°€ **
        // =======================================================
        
        // ì—­í•  ë³€ê²½ ì‹œ í•„ë“œ í‘œì‹œ/ìˆ¨ê¹€
        $('#roleSelect').on('change', function() {
            const role = $(this).val();
            const $doctorFields = $('#doctorInfoSection');
            const $hospIdx = $('#hospIdx');
            const $inputSpecialty = $('#inputSpecialty');

            if (role === 'DOCTOR') {
                $doctorFields.slideDown(200); // ì˜ì‚¬ í•„ë“œ í‘œì‹œ
                isDoctor = true;
                // í•„ìˆ˜ ì†ì„±ì€ í¼ ì œì¶œ ì‹œ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ê²€ì¦

            } else {
                $doctorFields.slideUp(200); // ì˜ì‚¬ í•„ë“œ ìˆ¨ê¹€
                isDoctor = false;
                
                // USERë¡œ ë³€ê²½ ì‹œ ë¶ˆí•„ìš”í•œ ê°’ ì œì¶œ ë°©ì§€ë¥¼ ìœ„í•´ ë¹„ì›Œì¤ë‹ˆë‹¤.
                $hospIdx.val(''); 
                $('#hospNameDisplay').val('');
                $inputSpecialty.val('');
            }
        }).trigger('change'); // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ìƒíƒœ ì ìš©

        // [ë³‘ì› ê²€ìƒ‰ ë²„íŠ¼] í´ë¦­ ì´ë²¤íŠ¸
        $('#buttonHospitalSearch').on('click', function(e) {
            e.preventDefault();
            const url = '/hospital/searchPopup'; // HospitalPageControllerì˜ URL
            const name = 'hospitalSearchPopup';
            const features = 'width=650,height=750,scrollbars=yes';
            window.open(url, name, features);
        });

        // [ì½œë°± í•¨ìˆ˜] íŒì—…ì—ì„œ ì„ íƒëœ ë³‘ì› ì •ë³´ë¥¼ ë°›ê¸° ìœ„í•œ í•¨ìˆ˜
        // íŒì—… ì°½ì—ì„œ window.opener.setHospitalSelection(id, name)ì„ í˜¸ì¶œí•©ë‹ˆë‹¤.
        window.setHospitalSelection = function(hospIdx, hospName) {
            $('#hospNameDisplay').val(hospName); // ì‚¬ìš©ìì—ê²Œ í‘œì‹œë˜ëŠ” ë³‘ì› ì´ë¦„
            $('#hospIdx').val(hospIdx); // ì‹¤ì œë¡œ ì„œë²„ì— ì „ì†¡ë  ë³‘ì› PK
        };
        
     // 1. ë³‘ì› ê²€ìƒ‰ (REST API í˜¸ì¶œ)
        function searchHospitals() {
            const name = $('#hospitalSearchInput').val();
            if (!name.trim()) {
                $('#hospitalSearchResults').html('<p class="text-danger text-center">ê²€ìƒ‰í•  ë³‘ì› ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>');
                return;
            }

            fetch('/api/hospitals/search?name=' + encodeURIComponent(name))
                .then(response => {
                    if (!response.ok) {
                        throw new Error('ë„¤íŠ¸ì›Œí¬ ì‘ë‹µì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    }
                    return response.json();
                })
                .then(data => displayResults(data))
                .catch(error => {
                    console.error('Error fetching hospitals:', error);
                    $('#hospitalSearchResults').html('<p class="text-danger text-center">ë³‘ì› ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>');
                });
        }
     // 2. ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
        function displayResults(hospitals) {
            const resultsDiv = $('#hospitalSearchResults');
            resultsDiv.empty(); // ê¸°ì¡´ ê²°ê³¼ ë¹„ìš°ê¸°
            
            if (hospitals.length === 0) {
                resultsDiv.append('<p class="text-danger text-center">ê²€ìƒ‰í•  ë³‘ì› ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>');
                return;
            }

            hospitals.forEach(hospital => {
                const item = `
                	<div class="hospital-item">                        
                		<p class="hospital-name">${hospital.hospName}</p>
                		<p class="hospital-address">${hospital.addr1 ? hospital.addr1 : 'ì£¼ì†Œ ì •ë³´ ì—†ìŒ'}</p>
                		<div class="item-actions">
							<button class="btn btn-success select-hospital-btn"	data-hospital-id="${hospital.hospIdx}" data-hospital-name="${hospital.hospName.replace(/'/g, "\\'")}">ì„ íƒ</button>
							<button class="btn btn-info edit-hospital-btn" data-hospital-id="${hospital.hospIdx}">ìˆ˜ì •</button>
                       	</div>                        
                    </div>
                `;
                resultsDiv.append(item);
            });
        }
	</script>
	<script>
        // ì£¼ì†Œ ê²€ìƒ‰ í•¨ìˆ˜
        $("#searchNewHospitalZipCodeBtn").on("click", function(e) {
            e.preventDefault();
            new daum.Postcode({
                oncomplete: function(data) {
                    $("#newHospitalZipCode").val(data.zonecode);
                    $("#newHospitalAddr1").val(data.roadAddress);
                    $("#newHospitalAddr2").focus(); // ìƒì„¸ ì£¼ì†Œ ì…ë ¥ìœ¼ë¡œ í¬ì»¤ìŠ¤
                }
            }).open();
        });

        // í¼ ì œì¶œ ì´ë²¤íŠ¸ ì²˜ë¦¬
        $('#saveNewHospitalBtn').on('click', function(e) {
            e.preventDefault();          
            
            const hospitalData = {
            	hostIdx: newHospitalId.value,
                hospName: newHospitalName.value,
                zipCode: newHospitalZipCode.value,
                addr1: newHospitalAddr1.value,
                addr2: newHospitalAddr2.value,
                tel: newHospitalTel.value
            };
            //console.log("saveNewHospitalBtn hospitalData : " + JSON.stringify(hospitalData));
            // í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬ (ê°„ë‹¨í•˜ê²Œ)
            if (!hospitalData.hospName || !hospitalData.tel || !hospitalData.zipCode || !hospitalData.addr1) {
                alert('í•„ìˆ˜ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }            
            
            if(!hospitalData.hostIdx || hospitalData.hostIdx==0 ){
            	fetch('/api/hospitals/save', { // HospitalControllerì˜ POST ì—”ë“œí¬ì¸íŠ¸
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(hospitalData)
                })
                .then(response => {
                    if (!response.ok) {
                        // ì„œë²„ì—ì„œ ë°œìƒí•œ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤ë©´ ë” ìƒì„¸í•˜ê²Œ ì²˜ë¦¬
                        return response.json().then(err => { throw new Error(err.message || 'ë³‘ì› ë“±ë¡ ì‹¤íŒ¨'); });
                    }
                    return response.json();
                })
                .then(newHospital => {
    	            alert(`'${newHospital.hospName}' ë³‘ì›ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    	            searchHospitals();
    	            newHospitalForm.style.display = 'none';
                })
                .catch(error => {
                    console.error('ë³‘ì› ë“±ë¡ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                    alert('ë³‘ì› ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                });
            } else {
            	let hospitalIdToEdit = hospitalData.hostIdx;
            	fetch(`/api/hospitals/${hospitalIdToEdit}`, { // HospitalControllerì˜ POST ì—”ë“œí¬ì¸íŠ¸
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(hospitalData)
                })
                .then(response => {
                    if (!response.ok) {
                        // ì„œë²„ì—ì„œ ë°œìƒí•œ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤ë©´ ë” ìƒì„¸í•˜ê²Œ ì²˜ë¦¬
                        return response.json().then(err => { throw new Error(err.message || 'ë³‘ì› ìˆ˜ì • ì‹¤íŒ¨'); });
                    }
                    return response.json();
                })
                .then(newHospital => {
    	            alert(`'${newHospital.hospName}' ë³‘ì›ì´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    	            searchHospitals();
    	            newHospitalForm.style.display = 'none';
                })
                .catch(error => {
                    console.error('ë³‘ì› ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                    alert('ë³‘ì› ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                });
            }
        });
        
     	// â­ï¸â­ï¸ ë³‘ì› ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ â­ï¸â­ï¸
		searchHospitalBtn.addEventListener('click', function() {
            // CSSì—ì„œ display: none; ë˜ì–´ ìˆë˜ ìš”ì†Œë¥¼ ë³´ì´ê²Œ í•©ë‹ˆë‹¤.
    		searchHospitals();
            hospitalSearchResults.style.display = 'block'; 
        });
     	
		 // --- ë³‘ì› ê²€ìƒ‰ ë° ì¶”ê°€ ëª¨ë‹¬ ì œì–´ (ìœ ì§€) ---
	    openHospitalModalBtn.addEventListener('click', () => {
			//alert("ë³‘ì› ê²€ìƒ‰ ëª¨ë‹¬");
			$("#newHospitalId").val(0);
	        hospitalModal.style.display = 'flex';
	    });
		 
	 	// â­ï¸â­ï¸ ë³‘ì› ì„ íƒ ë²„íŠ¼ í´ë¦­ ì‹œ ë©”ì¸ í¼ì— ì ìš© â­ï¸â­ï¸
	    hospitalSearchResults.addEventListener('click', function(event) {	    	
	        if (event.target.classList.contains('select-hospital-btn')) {
	            const hospitalItem = event.target.closest('.hospital-item');
	            
	            // ë³‘ì› ì´ë¦„ê³¼ ID (data- ì†ì„± ì‚¬ìš©) ê°€ì ¸ì˜¤ê¸°
	            const selectedHospitalName = hospitalItem.querySelector('.hospital-name').textContent;
	            const selectedHospitalId = event.target.dataset.hospitalId;
	            // ë©”ì¸ í¼ì— ì ìš©
	            hospitalNameInput.value = selectedHospitalName;
	            hospitalIdInput.value = selectedHospitalId;
	            
	            // ëª¨ë‹¬ ë‹«ê¸°
	            hospitalModal.style.display = 'none';
	            newHospitalForm.style.display = 'none';
	            
	            //alert(`"${selectedHospitalName}" ë³‘ì›ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤.`);
	        } else if (event.target.classList.contains('edit-hospital-btn')) {
	            const hospitalIdToEdit = event.target.dataset.hospitalId;
	            
	            
	            //alert(`ë³‘ì› ID ${hospitalIdToEdit} ìˆ˜ì • í¼ì„ ë„ì›ë‹ˆë‹¤.`);
	            newHospitalForm.style.display = 'block'; 
	            
	            $.ajax({
	                url: `/api/hospitals/${hospitalIdToEdit}`, // URL ìˆ˜ì •
	                method: 'GET',
	                contentType: 'application/json', // GET ìš”ì²­ì—ì„œëŠ” ë³´í†µ ìƒëµí•˜ì§€ë§Œ ëª…í™•íˆ ì§€ì •
	                dataType: 'json', // ì„œë²„ë¡œë¶€í„° ë°›ì„ ë°ì´í„° í˜•ì‹
	                
	                success: function(hospitalData) {
	                    // HTTP ìƒíƒœ ì½”ë“œê°€ 200 (OK)ì¼ ë•Œ ì‹¤í–‰ë©ë‹ˆë‹¤.
	                    
	                    // â­ï¸â­ï¸ ê°ì²´ì˜ ì†ì„±ê°’ì„ ì§ì ‘ í• ë‹¹í•©ë‹ˆë‹¤. â­ï¸â­ï¸
	                    if (typeof newHospitalId !== 'undefined') {
	                        newHospitalId.value = hospitalData.hospIdx || '';
	                    }
	                    newHospitalName.value = hospitalData.hospName || '';
	                    newHospitalTel.value = hospitalData.tel || '';
	                    newHospitalZipCode.value = hospitalData.zipCode || '';
	                    newHospitalAddr1.value = hospitalData.addr1 || '';
	                    newHospitalAddr2.value = hospitalData.addr2 || '';

	                    // í¼ê³¼ ëª¨ë‹¬ì„ ë³´ì´ê²Œ í•©ë‹ˆë‹¤.
	                    // ë³‘ì› ìˆ˜ì • ì‹œì—ëŠ” newHospitalFormì„ ë¨¼ì € ë³´ì—¬ì•¼ í•©ë‹ˆë‹¤.
	                    if (typeof newHospitalForm !== 'undefined') {
	                         newHospitalForm.style.display = 'block'; 
	                    }
	                    hospitalModal.style.display = 'flex';
	                },
	                
	                error: function(xhr, status, error) {
	                    // ì„œë²„ ì‘ë‹µì´ 4xx, 5xx ì—ëŸ¬ì´ê±°ë‚˜ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ ì‹¤í–‰ë©ë‹ˆë‹¤.
	                    console.error('ë³‘ì› ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ', status, error);
	                    
	                    let errorMessage = 'ë³‘ì› ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
	                    if (xhr.responseJSON && xhr.responseJSON.message) {
	                         errorMessage = xhr.responseJSON.message;
	                    }
	                    alert(errorMessage);
	                }
	            });
	        }
	    });
    </script>
	<script>
    /**
     * 1. íšŒì› ì •ë³´ ë¡œë“œ ë° í¼ì— ì„¤ì •í•˜ëŠ” í•¨ìˆ˜
     * @param {number} memberId - ì¡°íšŒí•  íšŒì›ì˜ ID (ì„¸ì…˜ ë“±ì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨)
     */
    async function loadMemberData(memberId) {
        // ì‹¤ì œ API ì—”ë“œí¬ì¸íŠ¸ë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.
        console.log("memberId : " + memberId);
        const apiUrl = `/api/members/info/${memberId}`; 

        try {
            const response = await fetch(apiUrl);
            
            if (!response.ok) {
                throw new Error('íšŒì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
            
            const member = await response.json();
            
            // â­ï¸ í¼ í•„ë“œì— ë°ì´í„° ì„¤ì • â­ï¸
            // IDì™€ ì—­í• ì€ ìˆ˜ì • ë¶ˆê°€ëŠ¥í•˜ë„ë¡ ì„¤ì • (ì¼ë°˜ì ì¸ ê²½ìš°)
            $inputId.value = member.userId;
            $inputId.readOnly = true; // ID ìˆ˜ì • ë¶ˆê°€
            
            $inputName.value = member.name || '';
            $inputPhone.value = member.phone || '';
            $inputEmail.value = member.email || '';

            // ì£¼ì†Œ ì •ë³´ ì„¤ì •
            $zipCode.value = member.zipCode || '';
            $streetAdr.value = member.addr1 || '';
            $inputAddressDetail.value = member.addr2 || '';

            // ì—­í•  ì„¤ì • ë° ì˜ì‚¬ ì„¹ì…˜ í‘œì‹œ
            $roleSelect.value = member.role || 'USER';
            $roleSelect.disabled = true; // ì—­í•  ìˆ˜ì • ë¶ˆê°€ (ì¼ë°˜ì ì¸ ê²½ìš°)

            if (member.role === 'DOCTOR') {
                $doctorInfoSection.style.display = 'block';
                
                // ì˜ì‚¬ ì •ë³´ ì„¤ì •
                $inputSpecialty.value = member.specialty || '';
                
                // ë³‘ì› ì •ë³´ ì„¤ì •
                if (member.hospIdx) {
                    $hospIdx.value = member.hospIdx;
                    $hospNameDisplay.value = member.hospName;
                }
            }
            if(member.agreementYn==='Y'){
            	$('#checkTerms3').prop('checked',true);
            	$('#agreements').val('Y');            	
            } else {
            	$('#checkTerms3').prop('checked',false);
            	$('#agreements').val('N');
            }
            // í”„ë¡œí•„ ì´ë¯¸ì§€ ì„¤ì • (ë§Œì•½ URLì´ ìˆë‹¤ë©´)
             if (member.profileImg) {
                 document.querySelector('.profile-image').src = member.profileImg;
                 $('#oldImgPath').val(member.profileImg);
             }

        } catch (error) {
            console.error("íšŒì› ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:", error);
            alert("íšŒì› ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message);
        }
    }

    // ğŸ’¡ í˜ì´ì§€ ë¡œë“œ ì‹œ í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´ ë¡œë“œ (ì˜ˆì‹œ: memberId=1)
    // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ì„¸ì…˜ ë˜ëŠ” í† í°ì—ì„œ memberIdë¥¼ ê°€ì ¸ì™€ì•¼ í•©ë‹ˆë‹¤.
    window.addEventListener('load', () => {
        const loggedInMemberId = MEMBER_ID; // â­ï¸ ì‹¤ì œ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì IDë¡œ ë³€ê²½ í•„ìš” â­ï¸
        loadMemberData(loggedInMemberId);
    });


    
</script>
</body>
</html>