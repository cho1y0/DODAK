# Dodak 통합 테스트 케이스

## 문서 정보

| 항목 | 내용 |
|------|------|
| 프로젝트명 | Dodak (AI 기반 감정 일기 & 심리 케어 플랫폼) |
| 문서 버전 | 1.0 |
| 작성일 | 2026-02-09 |
| 작성자 | 지태민 (데이터베이스·테스트) |

---

## 1. 개요

통합 테스트는 DODAK 시스템의 각 컴포넌트(Spring Boot, FastAPI, MySQL, YouTube 크롤링)가 연동되어 정상 동작하는지 검증합니다.

### 1.1 테스트 범위

| 통합 영역 | 설명 |
|-----------|------|
| Web ↔ DB | Spring Boot + MySQL JPA 연동 |
| Web ↔ AI | Spring Boot + FastAPI 감정 분석 연동 |
| Web ↔ Crawling | Spring Boot + FastAPI + Selenium YouTube 크롤링 |
| Auth ↔ Role | Spring Security 인증 후 역할별 기능 접근 |
| Diary ↔ Analysis | 일기 저장과 AI 분석 결과 자동 연계 |
| Doctor ↔ Patient | 의사-환자 배정 및 데이터 열람 연계 |

---

## 2. End-to-End 시나리오 테스트

### IT-E2E-001: 사용자 일기 작성 → AI 분석 → 결과 확인 전체 흐름

| 항목 | 내용 |
|------|------|
| 테스트 ID | IT-E2E-001 |
| 우선순위 | 최상 |
| 사전조건 | Spring Boot (:8083), FastAPI (:8000), MySQL 모두 실행 |

**테스트 절차**:
1. USER 계정으로 로그인
2. `/member/diary-write` 이동
3. 제목: "통합 테스트 일기", 내용: "오늘은 기쁜 하루였다. 친구를 만나서 행복했다."
4. "일기 저장하기" 클릭
5. 일기 저장 성공 확인
6. tb_diary 레코드 생성 확인
7. FastAPI `/diary?s=...` 호출 확인
8. tb_analysis 레코드 생성 확인 (joy_ratio 높은 값)
9. 감정 분석 결과 화면 표시 확인

**기대 결과**:
- 일기 저장 → AI 분석 → DB 저장 → 결과 표시 전체 파이프라인 정상
- tb_diary.diary_idx와 tb_analysis.diary_idx FK 일치
- 분석 결과에 joy 비율이 가장 높음

| 결과 | PASS |
|------|------|

---

### IT-E2E-002: 의사 환자 모니터링 전체 흐름

| 항목 | 내용 |
|------|------|
| 테스트 ID | IT-E2E-002 |
| 우선순위 | 최상 |
| 사전조건 | DOCTOR/USER 계정 존재, 환자 배정 완료, 일기+분석 데이터 존재 |

**테스트 절차**:
1. DOCTOR 계정으로 로그인 → `/doctor/main` 이동
2. `/doctor/dashboard` 이동
3. 요약 카드 4개 데이터 확인 (배정 환자, 중증, 일기 수, 행복지수)
4. 감정 분포 파이 차트 데이터 확인
5. `/doctor/patient-stats` 이동 → 환자 선택
6. 월별 우울/행복지수 확인
7. `/doctor/patient-diary-list` 이동 → 환자 일기 열람
8. 일기 상세 모달에서 분석 결과 확인

**기대 결과**:
- 대시보드 통계 데이터 정확
- 환자 통계 차트 정상 렌더링
- 환자 일기 열람 및 분석 결과 모달 정상

| 결과 | PASS |
|------|------|

---

### IT-E2E-003: 회원가입 → 로그인 → 일기 작성 → 챗봇 → 음악 추천

| 항목 | 내용 |
|------|------|
| 테스트 ID | IT-E2E-003 |
| 우선순위 | 상 |
| 사전조건 | 전체 서버 실행 |

**테스트 절차**:
1. `/join`에서 신규 USER 가입
2. 가입된 계정으로 `/login` 로그인
3. `/member/diary-write`에서 일기 작성 → 저장
4. AI 감정 분석 결과 확인
5. "기분에 따른 추천 영상 목록보기" 클릭
6. YouTube 음악 추천 목록 확인
7. 챗봇 페이지에서 대화 시도

**기대 결과**:
- 신규 가입 → 로그인 → 일기 → 분석 → 음악 → 챗봇 전체 흐름 정상

| 결과 | PASS |
|------|------|

---

## 3. 컴포넌트 통합 테스트

### 3.1 Spring Boot ↔ MySQL 통합

| TC ID | 테스트 항목 | 테스트 절차 | 기대 결과 | 결과 |
|-------|------------|------------|----------|------|
| IT-DB-001 | 회원 CRUD | 회원 생성/조회/수정/삭제 | JPA → MySQL 정상 반영 | PASS |
| IT-DB-002 | 일기 CRUD | 일기 생성/조회/수정/삭제 | tb_diary 정상 반영, FK 무결성 | PASS |
| IT-DB-003 | 분석 결과 저장 | 분석 결과 INSERT | tb_analysis 정상 저장, diary_idx UNIQUE | PASS |
| IT-DB-004 | QueryDSL 동적 쿼리 | 날짜+키워드 복합 검색 | DiaryRepositoryImpl 정상 동작 | PASS |
| IT-DB-005 | JOIN FETCH 쿼리 | 일기+분석 한번에 조회 | N+1 문제 없이 결과 반환 | PASS |
| IT-DB-006 | 트랜잭션 롤백 | 일기 저장 중 예외 발생 | 일기+분석 모두 롤백 | PASS |
| IT-DB-007 | 병원-의사 관계 | 병원 등록 → 의사 연동 | FK 정상, 병원 삭제 시 제약 | PASS |
| IT-DB-008 | 환자 배정 관계 | 환자-의사 배정 저장 | tb_arrange FK 정상 | PASS |

### 3.2 Spring Boot ↔ FastAPI 통합

| TC ID | 테스트 항목 | 테스트 절차 | 기대 결과 | 결과 |
|-------|------------|------------|----------|------|
| IT-AI-001 | 감정 분석 API 연동 | 일기 저장 → RestTemplate → FastAPI | 8감정+우울증 JSON 정상 수신 | PASS |
| IT-AI-002 | Simple 챗봇 연동 | 메시지 → `/chatbot/g` | KoGPT2 응답 정상 수신 | PASS |
| IT-AI-003 | Complex 챗봇 연동 | 메시지 → `/chatbot/b` | KoBERT 응답 정상 수신 | PASS |
| IT-AI-004 | YouTube 크롤링 연동 | 감정 키워드 → `/youtube/search` | 영상 목록 JSON 정상 수신 | PASS |
| IT-AI-005 | AI 서버 장애 시 | FastAPI 중지 후 일기 저장 | 일기 저장 성공, 분석 없음 (에러 핸들링) | PASS |
| IT-AI-006 | AI 응답 타임아웃 | 느린 네트워크 시뮬레이션 | 타임아웃 처리, 일기는 저장 | PASS |
| IT-AI-007 | 한글 URL 인코딩 | 한글 일기 → URL 인코딩 → FastAPI | 한글 정상 디코딩, 분석 정상 | PASS |
| IT-AI-008 | 분석 결과 DTO 매핑 | FastAPI JSON → AnalysisResponse | 모든 필드 정상 매핑 | PASS |

### 3.3 Spring Security 통합

| TC ID | 테스트 항목 | 테스트 절차 | 기대 결과 | 결과 |
|-------|------------|------------|----------|------|
| IT-SEC-001 | USER 로그인 → 권한 | USER 로그인 후 회원 API 접근 | 정상 접근 | PASS |
| IT-SEC-002 | USER → DOCTOR API | USER로 `/doctor/**` 접근 | 403 Forbidden | PASS |
| IT-SEC-003 | DOCTOR → 환자 데이터 | DOCTOR로 배정 환자 데이터 접근 | 정상 접근 | PASS |
| IT-SEC-004 | 비인증 → 보호 API | 비로그인으로 `/api/members/info/*` | 리다이렉트 또는 401 | PASS |
| IT-SEC-005 | 세션 생성/파괴 | 로그인/로그아웃 사이클 | 세션 정상 관리 | PASS |
| IT-SEC-006 | CustomAuthSuccessHandler | USER/DOCTOR 로그인 성공 | 역할별 올바른 리다이렉트 | PASS |
| IT-SEC-007 | BCrypt 비밀번호 매칭 | 가입 → 로그인 | encode → matches 정상 | PASS |

---

## 4. 데이터 무결성 테스트

| TC ID | 테스트 항목 | 테스트 절차 | 기대 결과 | 결과 |
|-------|------------|------------|----------|------|
| IT-INT-001 | 일기 삭제 → 분석 삭제 | 일기 삭제 실행 | 관련 tb_analysis도 삭제 (CASCADE) | PASS |
| IT-INT-002 | 회원 삭제 → 일기 관계 | 회원 삭제 시도 | FK 제약 확인 (일기 존재 시 삭제 불가) | PASS |
| IT-INT-003 | 중복 분석 방지 | 같은 diary_idx로 분석 2회 | UNIQUE 제약 위반 또는 UPDATE | PASS |
| IT-INT-004 | 의사-병원 FK | 미등록 병원 ID로 의사 등록 | FK 제약 위반 에러 | PASS |
| IT-INT-005 | 배정 중복 방지 | 같은 환자-의사 배정 2회 | 중복 처리 (에러 또는 무시) | PASS |
| IT-INT-006 | 프로필 이미지 파일 | 이미지 업로드 → UUID 파일명 | 파일 저장 + DB 경로 일치 | PASS |

---

## 5. 동시성 테스트

| TC ID | 테스트 항목 | 테스트 절차 | 기대 결과 | 결과 |
|-------|------------|------------|----------|------|
| IT-CON-001 | 동시 일기 저장 | 5명 동시 일기 저장 | 모든 일기 정상 저장, 분석 정상 | PASS |
| IT-CON-002 | 동시 로그인 | 10명 동시 로그인 | 모든 세션 정상 생성 | PASS |
| IT-CON-003 | 동시 분석 요청 | 3명 동시 AI 분석 요청 | FastAPI 순차/병렬 처리 정상 | PASS |
| IT-CON-004 | 동시 대시보드 조회 | 3명 의사 동시 대시보드 | 각 의사별 데이터 정상 분리 | PASS |

---

## 6. 회귀 테스트

| TC ID | 테스트 항목 | 테스트 절차 | 기대 결과 | 결과 |
|-------|------------|------------|----------|------|
| IT-REG-001 | 로그인 후 전체 기능 | 로그인 → 모든 메뉴 순회 | 모든 페이지 정상 | PASS |
| IT-REG-002 | DOCTOR 전체 기능 | 의사 로그인 → 모든 메뉴 순회 | 모든 페이지 정상 | PASS |
| IT-REG-003 | API 전체 호출 | 모든 REST API 순차 호출 | 200/201 응답 | PASS |
| IT-REG-004 | 일기 CRUD 전체 | 생성 → 조회 → 수정 → 삭제 | 전체 사이클 정상 | PASS |

---

## 테스트 결과 요약

| 카테고리 | 테스트 수 | PASS | FAIL |
|----------|:--------:|:----:|:----:|
| E2E 시나리오 | 3 | 3 | 0 |
| DB 통합 | 8 | 8 | 0 |
| AI 통합 | 8 | 8 | 0 |
| Security 통합 | 7 | 7 | 0 |
| 데이터 무결성 | 6 | 6 | 0 |
| 동시성 | 4 | 4 | 0 |
| 회귀 | 4 | 4 | 0 |
| **합계** | **40** | **40** | **0** |

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|-----------|--------|
| 1.0 | 2026-02-09 | 최초 작성 (40개 통합 테스트) | 지태민 |
