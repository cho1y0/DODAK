# DODAK(도닥) 통합 테스트 케이스

## 문서 정보

| 항목 | 내용 |
|------|------|
| 프로젝트명 | DODAK (도닥) - AI 기반 감정 일기 & 심리 케어 플랫폼 |
| 버전 | 1.1 |
| 작성일 | 2026-02-09 |
| 작성자 | 지태민 (데이터베이스·테스트) |

---

## 1. 사용자 관리 (Web ↔ DB)

| 요구사항고유번호 | 요구사항명칭 | 사전조건 | 세부내용 |
|-----------------|-------------|----------|----------|
| UR-001 | 회원가입 | 시스템 접속 상태, 비로그인 상태 | ❍ 회원가입 페이지(`/join`) 접근<br>❍ 필수 정보 입력 (아이디, 비밀번호, 이름, 이메일, 전화번호)<br>❍ 역할 선택 (USER/DOCTOR)<br>❍ 가입 완료 버튼 클릭<br>❍ 입력값 검증 (아이디 중복 확인, 비밀번호 형식)<br>❍ BCrypt 비밀번호 암호화 저장<br>❍ tb_member 레코드 생성 확인<br>❍ 가입 완료 후 로그인 페이지 이동 |
| UR-002 | 로그인 | 등록된 계정 존재 | ❍ 로그인 페이지(`/login`) 접근<br>❍ 아이디, 비밀번호 입력<br>❍ 로그인 버튼 클릭<br>❍ Spring Security 인증 처리<br>❍ BCrypt 비밀번호 검증<br>❍ 세션 생성<br>❍ CustomAuthSuccessHandler 역할별 리다이렉트 (USER→`/member/home`, DOCTOR→`/doctor/home`) |
| UR-003 | 로그아웃 | 로그인 상태 | ❍ 로그아웃 버튼 클릭<br>❍ Spring Security 세션 무효화<br>❍ 메인 페이지(`/`) 이동 |
| UR-004 | 개인정보 수정 | 로그인 상태 | ❍ 마이페이지(`/member/mypage` 또는 `/doctor/mypage`) 접근<br>❍ 수정할 정보 변경 (이름, 이메일, 전화번호, 프로필 이미지)<br>❍ 저장 버튼 클릭<br>❍ tb_member 업데이트 확인<br>❍ 변경사항 즉시 반영 |
| UR-005 | 개인정보 조회 | 로그인 상태 | ❍ 마이페이지 접근<br>❍ 사용자 정보 표시 (아이디, 이름, 이메일, 전화번호, 역할)<br>❍ 프로필 이미지 표시<br>❍ `/api/members/info/{id}` API 정상 응답 확인 |

---

## 2. 감정 일기 (Web ↔ DB ↔ AI)

| 요구사항고유번호 | 요구사항명칭 | 사전조건 | 세부내용 |
|-----------------|-------------|----------|----------|
| DR-001 | 일기 작성 및 저장 | USER 권한으로 로그인 | ❍ 일기 작성 페이지(`/member/diary-write`) 접근<br>❍ 제목, 내용 입력<br>❍ 사진 첨부 (file1~file3, 선택사항)<br>❍ "일기 저장하기" 클릭<br>❍ `/api/diaries` POST 호출<br>❍ tb_diary 레코드 생성 확인<br>❍ 파일 업로드 시 UUID 파일명 저장 확인 |
| DR-002 | AI 감정 분석 연동 | 일기 저장 완료, FastAPI 서버 가동 | ❍ 일기 저장 직후 RestTemplate으로 FastAPI `/diary?s=...` 호출<br>❍ 한글 텍스트 URL 인코딩 전송<br>❍ KoBERT 모델 9가지 감정 비율 + 우울증 위험도 JSON 수신<br>❍ AnalysisResponse DTO 매핑 확인<br>❍ tb_analysis 레코드 생성 (diary_idx FK 연결)<br>❍ 감정 분석 결과 화면 표시 (파이 차트) |
| DR-003 | 일기 목록 조회 | 작성된 일기 존재 | ❍ 일기 목록 페이지(`/member/diary-list`) 접근<br>❍ 본인 일기 목록 표시 (날짜순 정렬)<br>❍ QueryDSL 동적 쿼리 동작 확인<br>❍ 일기 클릭 시 상세 모달 표시<br>❍ 분석 결과 함께 조회 (JOIN FETCH) |
| DR-004 | 일기 수정 | 본인 작성 일기 존재 | ❍ 일기 상세에서 수정 버튼 클릭<br>❍ 제목, 내용 변경<br>❍ `/api/diaries/{id}` PUT 호출<br>❍ tb_diary 업데이트 확인<br>❍ AI 재분석 실행 및 tb_analysis 업데이트 |
| DR-005 | 일기 삭제 | 본인 작성 일기 존재 | ❍ 일기 상세에서 삭제 버튼 클릭<br>❍ 삭제 확인 팝업<br>❍ `/api/diaries/{id}` DELETE 호출<br>❍ tb_diary 레코드 삭제<br>❍ tb_analysis 관련 레코드 CASCADE 삭제 확인<br>❍ 첨부 파일 삭제 확인 |
| DR-006 | AI 서버 장애 시 일기 저장 | FastAPI 서버 중지 상태 | ❍ AI 서버 중지 후 일기 작성/저장<br>❍ 일기 저장 성공 (tb_diary 정상 생성)<br>❍ 감정 분석 실패 처리 (기본값 반환)<br>❍ 에러 핸들링 정상 동작, 서비스 가용성 유지 |

---

## 3. AI 챗봇 상담 (Web ↔ AI)

| 요구사항고유번호 | 요구사항명칭 | 사전조건 | 세부내용 |
|-----------------|-------------|----------|----------|
| CR-001 | Simple 챗봇 대화 | USER 권한으로 로그인, FastAPI 서버 가동 | ❍ 챗봇 페이지 접근<br>❍ 메시지 입력 후 전송<br>❍ RestTemplate으로 FastAPI `/chatbot/g?s=...` 호출<br>❍ KoGPT2 모델 응답 수신<br>❍ 챗봇 응답 화면 표시<br>❍ 3초 이내 응답 확인 |
| CR-002 | Complex 챗봇 대화 | USER 권한으로 로그인, FastAPI 서버 가동 | ❍ 챗봇 페이지에서 심층 상담 모드 선택<br>❍ 메시지 입력 후 전송<br>❍ RestTemplate으로 FastAPI `/chatbot/b?s=...` 호출<br>❍ KoBERT 모델 응답 수신<br>❍ 상담 응답 화면 표시<br>❍ 우울증 고위험 키워드 감지 시 전문 상담 안내 |
| CR-003 | 챗봇 응답 타임아웃 | AI 서버 느린 응답 상태 | ❍ 느린 네트워크 시뮬레이션<br>❍ 타임아웃 처리 확인<br>❍ 사용자에게 재시도 안내 메시지 표시 |

---

## 4. 음악 추천 (Web ↔ AI ↔ YouTube)

| 요구사항고유번호 | 요구사항명칭 | 사전조건 | 세부내용 |
|-----------------|-------------|----------|----------|
| MR-001 | 감정 맞춤 음악 검색 | 감정 분석 완료, FastAPI 서버 가동 | ❍ 감정 분석 결과 화면에서 "기분에 따른 추천 영상 목록보기" 클릭<br>❍ 분석된 감정 키워드를 FastAPI `/youtube/search` POST 전송<br>❍ Selenium 기반 YouTube 크롤링 실행<br>❍ 영상 목록 JSON 정상 수신<br>❍ 추천 음악 목록 화면 표시<br>❍ 10초 이내 응답 확인 |
| MR-002 | 음악 추천 결과 표시 | 크롤링 결과 존재 | ❍ YouTube 영상 썸네일, 제목 표시<br>❍ 영상 클릭 시 YouTube 연결<br>❍ 9가지 감정별 적절한 음악 추천 확인 |

---

## 5. 인증 및 권한 제어 (Auth ↔ Role)

| 요구사항고유번호 | 요구사항명칭 | 사전조건 | 세부내용 |
|-----------------|-------------|----------|----------|
| SEC-001 | 비밀번호 암호화 | 회원가입 또는 비밀번호 변경 | ❍ 비밀번호 입력<br>❍ BCrypt 해시 알고리즘으로 암호화<br>❍ 암호화된 비밀번호 tb_member 저장<br>❍ 로그인 시 BCrypt matches()로 검증 |
| SEC-002 | 역할 기반 접근 제어 | 로그인 상태 | ❍ USER: `/member/**` 접근 가능, `/doctor/**` 접근 불가 (403)<br>❍ DOCTOR: `/doctor/**` 접근 가능<br>❍ 비로그인: 보호 API 접근 시 `/login`으로 리다이렉트<br>❍ Spring Security FilterChain 정상 동작 |
| SEC-003 | 역할별 로그인 리다이렉트 | 로그인 성공 | ❍ USER 로그인 → `/member/home` 이동<br>❍ DOCTOR 로그인 → `/doctor/home` 이동<br>❍ CustomAuthSuccessHandler 정상 동작 |
| SEC-004 | 세션 관리 | 로그인/로그아웃 사이클 | ❍ 로그인 시 세션 생성<br>❍ 세션에 사용자 정보 저장<br>❍ 로그아웃 시 세션 파괴<br>❍ 세션 만료 시 자동 리다이렉트 |
| SEC-005 | CORS 설정 | 외부 Origin 접근 | ❍ 허용된 Origin에서 API 접근 시 정상 응답<br>❍ 허용되지 않은 Origin에서 접근 시 차단 |

---

## 6. 의사-환자 연동 (Doctor ↔ Patient)

| 요구사항고유번호 | 요구사항명칭 | 사전조건 | 세부내용 |
|-----------------|-------------|----------|----------|
| DPR-001 | 환자 배정 | DOCTOR 권한으로 로그인, 병원 등록 완료 | ❍ 의사 마이페이지에서 환자 배정 기능 접근<br>❍ 배정할 환자 선택<br>❍ tb_arrange 레코드 생성 (member_id FK, doc_idx FK)<br>❍ 배정 상태(status) 저장<br>❍ 중복 배정 방지 확인 |
| DPR-002 | 의사 대시보드 조회 | DOCTOR 로그인, 배정 환자 및 일기/분석 데이터 존재 | ❍ 대시보드 페이지(`/doctor/dashboard`) 접근<br>❍ `/api/analyses/dashboard/{id}` API 호출<br>❍ 요약 카드 4개 데이터 확인 (배정 환자 수, 중증 환자 수, 총 일기 수, 평균 행복지수)<br>❍ 감정 분포 파이 차트 데이터 정확성 확인<br>❍ 중증 환자 목록 표시 |
| DPR-003 | 환자 통계 조회 | DOCTOR 로그인, 배정 환자의 분석 데이터 존재 | ❍ 환자 통계 페이지(`/doctor/patient-stats`) 접근<br>❍ `/api/analyses/stats/{id}` API 호출<br>❍ 환자 선택 후 월별 감정 추이 차트 확인<br>❍ 우울지수/행복지수 시계열 그래프 정상 렌더링<br>❍ 데이터 정확성 (tb_analysis 집계와 일치) |
| DPR-004 | 환자 일기 열람 | DOCTOR 로그인, 배정 환자의 일기 존재 | ❍ 환자 일기 목록 페이지(`/doctor/patient-diary-list`) 접근<br>❍ 배정된 환자의 일기만 표시 (비배정 환자 일기 접근 불가)<br>❍ 일기 클릭 시 상세 모달 표시<br>❍ 감정 분석 결과 함께 표시 |
| DPR-005 | 의사-병원 연동 | 병원 등록 완료 | ❍ 병원 검색 팝업(`/hospital/searchPopup`)에서 병원 선택<br>❍ tb_doctor 레코드에 hosp_idx FK 연결<br>❍ 미등록 병원 ID로 의사 등록 시 FK 제약 위반 확인<br>❍ 병원 정보 변경 시 의사 정보 연동 |

---

## 7. 병원 관리 (Web ↔ DB)

| 요구사항고유번호 | 요구사항명칭 | 사전조건 | 세부내용 |
|-----------------|-------------|----------|----------|
| HR-001 | 병원 등록 | DOCTOR 권한으로 로그인 | ❍ 병원 등록 페이지(`/hospital/addForm`) 접근<br>❍ 병원명, 주소(addr1, addr2), 전화번호 입력<br>❍ 등록 버튼 클릭<br>❍ tb_hospital 레코드 생성 확인<br>❍ `/api/hospitals/all` GET에서 등록된 병원 조회 확인 |
| HR-002 | 병원 검색 | 등록된 병원 존재 | ❍ 병원 검색 팝업(`/hospital/searchPopup`) 접근<br>❍ 키워드 입력 후 검색<br>❍ 검색 결과 목록 표시<br>❍ 병원 선택 시 의사 정보에 연동 |

---

## 8. 데이터 무결성 (Diary ↔ Analysis)

| 요구사항고유번호 | 요구사항명칭 | 사전조건 | 세부내용 |
|-----------------|-------------|----------|----------|
| INT-001 | 일기-분석 FK 연계 | 일기 저장 및 AI 분석 완료 | ❍ tb_diary.diary_idx와 tb_analysis.diary_idx FK 일치 확인<br>❍ diary_idx UNIQUE 제약 확인 (1개 일기 = 1개 분석)<br>❍ 분석 결과 9개 감정 비율 합계 100% 확인 |
| INT-002 | 일기 삭제 시 분석 CASCADE | 일기+분석 데이터 존재 | ❍ 일기 삭제 실행<br>❍ tb_analysis 관련 레코드 자동 삭제 확인<br>❍ 고아 레코드 없음 확인 |
| INT-003 | 회원 삭제 시 FK 제약 | 일기가 있는 회원 | ❍ 일기가 존재하는 회원 삭제 시도<br>❍ FK 제약조건 위반 확인 (일기 존재 시 삭제 불가)<br>❍ 적절한 에러 메시지 반환 |
| INT-004 | 중복 분석 방지 | 분석 완료된 일기 | ❍ 같은 diary_idx로 분석 2회 시도<br>❍ UNIQUE 제약 위반 또는 UPDATE 처리 확인 |
| INT-005 | 배정 중복 방지 | 환자-의사 배정 완료 | ❍ 같은 환자-의사 조합으로 배정 2회 시도<br>❍ 중복 처리 확인 (에러 또는 무시) |
| INT-006 | 프로필 이미지 파일 무결성 | 이미지 업로드 | ❍ 이미지 업로드 시 UUID 파일명 생성<br>❍ 파일 서버 저장 경로와 DB 경로 일치 확인<br>❍ 파일 접근 정상 확인 |

---

## 9. 동시성 테스트

| 요구사항고유번호 | 요구사항명칭 | 사전조건 | 세부내용 |
|-----------------|-------------|----------|----------|
| CON-001 | 동시 일기 저장 | 5명 동시 접속 | ❍ 5명 사용자 동시 일기 저장 요청<br>❍ 모든 일기 정상 저장 확인<br>❍ 각 일기별 AI 감정 분석 정상 완료<br>❍ tb_diary, tb_analysis 레코드 수 일치 |
| CON-002 | 동시 로그인 | 10명 동시 접속 | ❍ 10명 동시 로그인 요청<br>❍ 모든 세션 정상 생성<br>❍ 각 사용자별 독립적 세션 확인 |
| CON-003 | 동시 AI 분석 요청 | 3명 동시 일기 저장 | ❍ 3명 동시 AI 분석 요청<br>❍ FastAPI 서버 순차/병렬 처리 정상<br>❍ 각 요청별 정확한 분석 결과 반환 |
| CON-004 | 동시 대시보드 조회 | 3명 의사 동시 접속 | ❍ 3명 의사 동시 대시보드 조회<br>❍ 각 의사별 배정 환자 데이터 정상 분리<br>❍ 데이터 혼재 없음 확인 |

---

## 10. 성능 요구사항

| 요구사항고유번호 | 요구사항명칭 | 사전조건 | 세부내용 |
|-----------------|-------------|----------|----------|
| PR-001 | 페이지 로딩 속도 | 시스템 정상 가동 | ❍ 전체 15개 페이지 로딩 테스트<br>❍ 3초 이내 완료<br>❍ 실측: 평균 462ms (84.6% 여유)<br>❍ 최대: 780ms (의사 대시보드) |
| PR-002 | API 응답 시간 | 시스템 정상 가동 | ❍ 일반 CRUD API 호출<br>❍ 2초 이내 응답<br>❍ 실측: 평균 167ms (91.6% 여유)<br>❍ 최대: 350ms (대시보드 통합 조회) |
| PR-003 | 일기 저장 응답 | 시스템 정상 가동 | ❍ 일기 저장 API 호출<br>❍ 1초 이내 완료<br>❍ 실측: 220ms (78.0% 여유) |
| PR-004 | AI 감정 분석 응답 | FastAPI + KoBERT 모델 로드 완료 | ❍ 일기 텍스트 감정 분석 요청<br>❍ 5초 이내 응답<br>❍ 실측: 평균 2,267ms (54.7% 여유)<br>❍ 9가지 감정 비율 + 우울증 위험도 포함 |
| PR-005 | 챗봇 응답 시간 | FastAPI + KoGPT2/KoBERT 모델 로드 완료 | ❍ Simple/Complex 챗봇 질의<br>❍ 3초 이내 응답<br>❍ 실측: Simple 1,800ms / Complex 2,200ms (평균 2,000ms, 33.3% 여유) |
| PR-006 | YouTube 음악 검색 | FastAPI + Selenium 가동 | ❍ 감정 키워드 기반 YouTube 크롤링<br>❍ 10초 이내 완료<br>❍ 실측: 6,500ms (35.0% 여유) |
| PR-007 | 동시 접속자 | 시스템 정상 가동 | ❍ 동시 접속 사용자 100명 이상 지원<br>❍ 실측: 100명 동시 접속 시 에러율 0%, 평균 380ms<br>❍ 서비스 안정성 유지 확인 |

---

## 테스트 결과 요약

| 구분 | 요구사항 수 | Pass | Fail | 미실행 |
|------|-----------|------|------|--------|
| 사용자 관리 | 5 | 5 | 0 | 0 |
| 감정 일기 | 6 | 6 | 0 | 0 |
| AI 챗봇 상담 | 3 | 3 | 0 | 0 |
| 음악 추천 | 2 | 2 | 0 | 0 |
| 인증 및 권한 제어 | 5 | 5 | 0 | 0 |
| 의사-환자 연동 | 5 | 5 | 0 | 0 |
| 병원 관리 | 2 | 2 | 0 | 0 |
| 데이터 무결성 | 6 | 6 | 0 | 0 |
| 동시성 | 4 | 4 | 0 | 0 |
| 성능 요구사항 | 7 | 7 | 0 | 0 |
| **합계** | **45** | **45** | **0** | **0** |

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|-----------|--------|
| 1.0 | 2026-02-09 | 최초 작성 (40개 통합 테스트) | 지태민 |
| 1.1 | 2026-02-09 | DOT-Project 형식 적용 (요구사항고유번호 기반), 10개 카테고리로 재구성, 성능 요구사항 7개 추가, 총 45개 테스트 케이스 | 지태민 |

---

*DODAK - 도닥도닥, 당신의 마음을 어루만져 드려요*
