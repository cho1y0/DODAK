# Dodak 기능 명세서

## 문서 정보

| 항목 | 내용 |
|------|------|
| 프로젝트명 | Dodak (AI 기반 감정 일기 & 심리 케어 플랫폼) |
| 문서 버전 | 1.0 |
| 작성일 | 2026-02-03 |

---

## 1. 시스템 개요

Dodak은 사용자의 일상 감정을 일기 형태로 기록하고, AI가 8가지 감정을 분석하여 심리적 건강 관리를 지원하는 웹 서비스입니다.

### 1.1 핵심 가치
- **감정 인식**: 일기를 통한 자기 감정 인식 및 기록
- **AI 분석**: 8가지 감정 자동 분류 및 우울증 위험도 예측
- **심리 지원**: AI 챗봇을 통한 24시간 심리 상담
- **치유 콘텐츠**: 감정 맞춤형 음악 추천

---

## 2. 사용자 역할

### 2.1 역할 정의

| 역할 | 코드 | 권한 |
|------|------|------|
| 일반 사용자 | USER | 일기 작성, 감정 분석, 챗봇, 예약 |
| 의사 | DOCTOR | 환자 정보 조회, 상담 관리 |
| 관리자 | ADMIN | 시스템 전체 관리 |

---

## 3. 기능 상세

### 3.1 회원 관리

#### 3.1.1 회원가입

**기능 설명**
- 신규 사용자 계정 생성

**입력 항목**

| 필드 | 필수 | 타입 | 제약조건 |
|------|------|------|----------|
| 아이디 (user_id) | O | String | 50자 이내, 중복 불가 |
| 비밀번호 (password) | O | String | 8자 이상, 영문+숫자 |
| 이름 (name) | O | String | 50자 이내 |
| 이메일 (email) | O | String | 이메일 형식 |
| 전화번호 (phone) | O | String | 20자 이내 |
| 우편번호 (zip_code) | O | String | 6자리 |
| 주소 (addr1, addr2) | O | String | 각 255자 이내 |
| 약관동의 (agreement_yn) | O | String | 'Y' 필수 |

**처리 흐름**
```
1. 입력값 유효성 검증
2. 아이디 중복 확인
3. 비밀번호 BCrypt 암호화
4. 회원 정보 DB 저장
5. 가입 완료 메시지 표시
```

#### 3.1.2 로그인

**기능 설명**
- Spring Security 기반 세션 인증

**처리 흐름**
```
1. 아이디/비밀번호 입력
2. CustomUserDetailsService에서 사용자 조회
3. 비밀번호 검증
4. CustomAuthSuccessHandler에서 세션 생성
5. 권한별 메인 페이지로 리다이렉트
   - USER → /member/main
   - DOCTOR → /doctor/main
```

#### 3.1.3 회원정보 수정

**수정 가능 항목**
- 비밀번호
- 이름
- 전화번호
- 주소 (우편번호, addr1, addr2)
- 프로필 이미지

---

### 3.2 일기 관리

#### 3.2.1 일기 작성

**기능 설명**
- 감정 일기 작성 및 자동 감정 분석

**입력 항목**

| 필드 | 필수 | 타입 | 설명 |
|------|------|------|------|
| 제목 (diary_title) | O | String | 255자 이내 |
| 내용 (diary_content) | O | TEXT | 일기 본문 |
| 첨부파일 (file1~3) | X | File | 이미지 최대 3개 |

**처리 흐름**
```
1. 일기 내용 입력
2. 첨부파일 업로드 (선택)
3. 일기 저장 (tb_diary)
4. FastAPI 감정 분석 API 호출
5. 분석 결과 저장 (tb_analysis)
6. 결과 화면 표시
```

#### 3.2.2 감정 분석 결과 화면

**표시 항목**
- 8가지 감정 비율 (차트/그래프)
- 우울증 위험도 (%)
- 주요 감정 하이라이트
- 추천 콘텐츠 (음악, 상담)

```
┌─────────────────────────────────────────────────┐
│              오늘의 감정 분석 결과                │
├─────────────────────────────────────────────────┤
│  😊 기쁨     ████████████░░░░░░░░  45.5%        │
│  😢 슬픔     ████░░░░░░░░░░░░░░░░  15.0%        │
│  😰 불안     ███░░░░░░░░░░░░░░░░░  10.5%        │
│  😤 분노     ██░░░░░░░░░░░░░░░░░░   8.0%        │
│  🤔 중립     ███░░░░░░░░░░░░░░░░░  12.0%        │
│  🌟 희망     ██░░░░░░░░░░░░░░░░░░   5.0%        │
│  😫 피로     █░░░░░░░░░░░░░░░░░░░   2.5%        │
│  😔 후회     █░░░░░░░░░░░░░░░░░░░   1.5%        │
├─────────────────────────────────────────────────┤
│  ⚠️ 우울증 위험도: 5.0% (정상)                   │
└─────────────────────────────────────────────────┘
```

#### 3.2.3 일기 목록 조회

**기능**
- 사용자별 일기 목록 표시
- 날짜순 정렬
- 감정 아이콘 표시

**목록 항목**

| 항목 | 설명 |
|------|------|
| 날짜 | 작성일 |
| 제목 | 일기 제목 |
| 주요 감정 | 가장 높은 비율의 감정 아이콘 |
| 첨부 여부 | 파일 첨부 아이콘 |

---

### 3.3 AI 챗봇

#### 3.3.1 Simple 챗봇 (KoGPT2)

**기능 설명**
- 가벼운 일상 대화 지원
- 감정 공감 및 위로

**API 호출**
```
GET /chatbot/g?s={사용자 입력}

Response:
{
  "answer": "많이 힘드시군요. 괜찮아요, 여기에 모든 것을 털어놓아도 좋습니다."
}
```

#### 3.3.2 Complex 챗봇 (KoBERT)

**기능 설명**
- 심층 심리 상담
- 감정 분류 기반 맞춤 응답
- 전문 상담 연결 안내

**특별 응답 케이스**

| 감지 키워드 | 응답 유형 |
|-------------|-----------|
| 화가, 분노 | 분노 조절 가이드 |
| 우울, 죽고 | 전문 상담 연결 안내 |
| 불안, 걱정 | 안정화 기법 안내 |

---

### 3.4 음악 추천

#### 3.4.1 감정 기반 음악 검색

**기능 설명**
- 분석된 감정에 맞는 YouTube 음악 추천
- Selenium 기반 실시간 크롤링

**감정-검색어 매핑**

| 감정 | 검색어 |
|------|--------|
| 분노 | 분노 가라앉히는 음악 |
| 불안 | 불안할때 듣는 노래 |
| 슬픔 | 슬플때 듣는 노래 |
| 기쁨 | 기쁠때 듣는 노래 |
| 후회 | 후회할때 듣는노래 |
| 희망 | 희망찬 브금 |
| 중립 | 머릿속이 복잡할때 듣는 노래 |
| 피로 | 지치고 힘들때 듣는 노래 |
| 우울 | 우울함을 달래줄 노래 |

**응답 데이터**

```json
{
  "keyword": "슬픔",
  "results": [
    {
      "name": "영상 제목",
      "thumnail": "썸네일 URL",
      "link": "https://youtube.com/watch?v=...",
      "viewCount": "100만회",
      "videoDate": "1년 전",
      "videoAuthor": "채널명",
      "videoAuthorImg": "채널 이미지 URL",
      "videoDescript": "영상 설명"
    }
  ],
  "time": "2026-02-03 14:30:00"
}
```

---

### 3.5 병원/의사 관리

#### 3.5.1 병원 등록

**입력 항목**

| 필드 | 필수 | 타입 |
|------|------|------|
| 병원명 | O | String(50) |
| 우편번호 | O | String(6) |
| 주소1 | O | String(255) |
| 주소2 | O | String(255) |
| 전화번호 | O | String(20) |

#### 3.5.2 의사 등록

**입력 항목**

| 필드 | 필수 | 타입 |
|------|------|------|
| 소속 병원 | O | FK (tb_hospital) |
| 회원 연동 | O | FK (tb_member) |
| 전문분야 | O | String |

---

### 3.6 예약 관리

#### 3.6.1 상담 예약

**입력 항목**

| 필드 | 필수 | 설명 |
|------|------|------|
| 의사 선택 | O | 상담 의사 |
| 예약 날짜 | O | 상담 희망일 |
| 예약 시간 | O | 상담 희망 시간 |
| 상담 내용 | X | 사전 메모 |

**예약 상태**

| 상태 | 설명 |
|------|------|
| PENDING | 예약 대기 |
| CONFIRMED | 예약 확정 |
| CANCELLED | 예약 취소 |
| COMPLETED | 상담 완료 |

---

## 4. 화면 흐름도

### 4.1 사용자 메인 플로우

```
[로그인] → [사용자 메인]
               │
    ┌──────────┼──────────┬──────────┬──────────┐
    ▼          ▼          ▼          ▼          ▼
[일기작성] [일기목록] [챗봇상담] [음악추천] [예약관리]
    │          │          │          │          │
    ▼          ▼          ▼          ▼          ▼
[감정분석] [상세보기] [대화진행] [영상재생] [예약신청]
    │          │
    └────┬─────┘
         ▼
   [분석결과확인]
         │
    ┌────┴────┐
    ▼         ▼
[음악추천] [전문상담]
```

### 4.2 의사 메인 플로우

```
[로그인] → [의사 메인]
               │
    ┌──────────┼──────────┐
    ▼          ▼          ▼
[환자목록] [예약관리] [상담이력]
    │          │          │
    ▼          ▼          ▼
[상세정보] [예약확정] [기록작성]
```

---

## 5. 비즈니스 규칙

### 5.1 일기 관련

| 규칙 ID | 규칙 내용 |
|---------|-----------|
| BR-D01 | 일기는 본인만 조회/수정/삭제 가능 |
| BR-D02 | 첨부파일은 최대 3개까지 허용 |
| BR-D03 | 일기 삭제 시 관련 분석 결과도 함께 삭제 |

### 5.2 분석 관련

| 규칙 ID | 규칙 내용 |
|---------|-----------|
| BR-A01 | 일기 1개당 분석 결과 1개 (1:1 관계) |
| BR-A02 | 우울증 위험도 30% 이상 시 전문 상담 안내 |
| BR-A03 | 분석 실패 시 기본값(중립 100%) 적용 |

### 5.3 예약 관련

| 규칙 ID | 규칙 내용 |
|---------|-----------|
| BR-R01 | 같은 시간대 중복 예약 불가 |
| BR-R02 | 예약 취소는 24시간 전까지 가능 |
| BR-R03 | 의사만 예약 상태 변경 가능 |

---

## 6. 에러 처리

### 6.1 에러 코드

| 코드 | 메시지 | 처리 |
|------|--------|------|
| E001 | 인증 실패 | 로그인 페이지로 리다이렉트 |
| E002 | 권한 없음 | 403 Forbidden 응답 |
| E003 | 데이터 없음 | 404 Not Found 응답 |
| E004 | AI 서버 연결 실패 | 기본 응답 제공 |
| E005 | 파일 업로드 실패 | 에러 메시지 표시 |

### 6.2 AI 분석 실패 시 대응

```
1. FastAPI 서버 연결 실패
   → 일기는 정상 저장
   → 분석 결과는 "분석 대기중" 상태로 저장
   → 재시도 로직 실행 (최대 3회)

2. 분석 결과 파싱 실패
   → 기본값 적용 (neutrality: 100%, 나머지: 0%)
   → 로그 기록
```

---

## 7. 성능 요구사항

| 항목 | 요구사항 |
|------|----------|
| 페이지 로딩 | 3초 이내 |
| 일기 저장 | 1초 이내 |
| 감정 분석 | 5초 이내 |
| 챗봇 응답 | 3초 이내 |
| 음악 검색 | 10초 이내 (크롤링 포함) |

---

## 8. 관련 문서

| 문서 | 설명 |
|------|------|
| [REQUIREMENTS.md](./REQUIREMENTS.md) | 요구사항 정의서 |
| [API_SPECIFICATION.md](./API_SPECIFICATION.md) | API 명세서 |
| [USE_CASES.md](./USE_CASES.md) | 유스케이스 명세서 |
| [SCREEN_DESIGN.md](./SCREEN_DESIGN.md) | 화면 설계서 |
| [TEST_CASES.md](./TEST_CASES.md) | 테스트 케이스 |

---

## 9. 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|-----------|--------|
| 1.0 | 2026-02-03 | 최초 작성 | 박제연 |
| 1.1 | 2026-02-09 | 관련 문서 링크 추가, 최신화 | 박제연 |
